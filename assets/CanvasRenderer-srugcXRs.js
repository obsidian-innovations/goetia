import{h as wn,w as Ft,R as dt,i as N,m as wt,M as U,c as z,P as mt,a as Nt,j as In,k as $,T as ct,I as Se,D as st,l as xt,e as rt,o as Ze,v as Rn,B as Oe,E as Dn,p as tt,V as Gn,q as nt,s as Ye,f as An,A as Bn}from"./index-Dwzt30Gb.js";import{G as $t,D as Fn,m as Hn,R as Ln,b as Wn,B as zn,n as qn,o as En,p as Un,A as Vn,C as jn}from"./RenderTargetSystem-hio9tZil.js";import{g as Nn}from"./getTextureBatchBindGroup-DFoNZ0lr.js";import{S as Xe,R as $n}from"./Geometry-DC-HkA7u.js";function ve(r,t,e=2){const n=t&&t.length,s=n?t[0]*e:r.length;let i=Qe(r,0,s,e,!0);const o=[];if(!i||i.next===i.prev)return o;let a,c,l;if(n&&(i=Qn(r,t,i,e)),r.length>80*e){a=r[0],c=r[1];let h=a,u=c;for(let f=e;f<s;f+=e){const d=r[f],p=r[f+1];d<a&&(a=d),p<c&&(c=p),d>h&&(h=d),p>u&&(u=p)}l=Math.max(h-a,u-c),l=l!==0?32767/l:0}return Dt(i,o,e,a,c,l,0),o}function Qe(r,t,e,n,s){let i;if(s===cs(r,t,e,n)>0)for(let o=t;o<e;o+=n)i=Te(o/n|0,r[o],r[o+1],i);else for(let o=e-n;o>=t;o-=n)i=Te(o/n|0,r[o],r[o+1],i);return i&&_t(i,i.next)&&(At(i),i=i.next),i}function gt(r,t){if(!r)return r;t||(t=r);let e=r,n;do if(n=!1,!e.steiner&&(_t(e,e.next)||L(e.prev,e,e.next)===0)){if(At(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function Dt(r,t,e,n,s,i,o){if(!r)return;!o&&i&&ns(r,n,s,i);let a=r;for(;r.prev!==r.next;){const c=r.prev,l=r.next;if(i?On(r,n,s,i):Zn(r)){t.push(c.i,r.i,l.i),At(r),r=l.next,a=l.next;continue}if(r=l,r===a){o?o===1?(r=Yn(gt(r),t),Dt(r,t,e,n,s,i,2)):o===2&&Xn(r,t,e,n,s,i):Dt(gt(r),t,e,n,s,i,1);break}}}function Zn(r){const t=r.prev,e=r,n=r.next;if(L(t,e,n)>=0)return!1;const s=t.x,i=e.x,o=n.x,a=t.y,c=e.y,l=n.y,h=Math.min(s,i,o),u=Math.min(a,c,l),f=Math.max(s,i,o),d=Math.max(a,c,l);let p=n.next;for(;p!==t;){if(p.x>=h&&p.x<=f&&p.y>=u&&p.y<=d&&Tt(s,a,i,c,o,l,p.x,p.y)&&L(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function On(r,t,e,n){const s=r.prev,i=r,o=r.next;if(L(s,i,o)>=0)return!1;const a=s.x,c=i.x,l=o.x,h=s.y,u=i.y,f=o.y,d=Math.min(a,c,l),p=Math.min(h,u,f),x=Math.max(a,c,l),g=Math.max(h,u,f),b=te(d,p,t,e,n),y=te(x,g,t,e,n);let P=r.prevZ,m=r.nextZ;for(;P&&P.z>=b&&m&&m.z<=y;){if(P.x>=d&&P.x<=x&&P.y>=p&&P.y<=g&&P!==s&&P!==o&&Tt(a,h,c,u,l,f,P.x,P.y)&&L(P.prev,P,P.next)>=0||(P=P.prevZ,m.x>=d&&m.x<=x&&m.y>=p&&m.y<=g&&m!==s&&m!==o&&Tt(a,h,c,u,l,f,m.x,m.y)&&L(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;P&&P.z>=b;){if(P.x>=d&&P.x<=x&&P.y>=p&&P.y<=g&&P!==s&&P!==o&&Tt(a,h,c,u,l,f,P.x,P.y)&&L(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;m&&m.z<=y;){if(m.x>=d&&m.x<=x&&m.y>=p&&m.y<=g&&m!==s&&m!==o&&Tt(a,h,c,u,l,f,m.x,m.y)&&L(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Yn(r,t){let e=r;do{const n=e.prev,s=e.next.next;!_t(n,s)&&Je(n,e,e.next,s)&&Gt(n,s)&&Gt(s,n)&&(t.push(n.i,e.i,s.i),At(e),At(e.next),e=r=s),e=e.next}while(e!==r);return gt(e)}function Xn(r,t,e,n,s,i){let o=r;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&is(o,a)){let c=tn(o,a);o=gt(o,o.next),c=gt(c,c.next),Dt(o,t,e,n,s,i,0),Dt(c,t,e,n,s,i,0);return}a=a.next}o=o.next}while(o!==r)}function Qn(r,t,e,n){const s=[];for(let i=0,o=t.length;i<o;i++){const a=t[i]*n,c=i<o-1?t[i+1]*n:r.length,l=Qe(r,a,c,n,!1);l===l.next&&(l.steiner=!0),s.push(rs(l))}s.sort(Kn);for(let i=0;i<s.length;i++)e=Jn(s[i],e);return e}function Kn(r,t){let e=r.x-t.x;if(e===0&&(e=r.y-t.y,e===0)){const n=(r.next.y-r.y)/(r.next.x-r.x),s=(t.next.y-t.y)/(t.next.x-t.x);e=n-s}return e}function Jn(r,t){const e=ts(r,t);if(!e)return t;const n=tn(e,r);return gt(n,n.next),gt(e,e.next)}function ts(r,t){let e=t;const n=r.x,s=r.y;let i=-1/0,o;if(_t(r,e))return e;do{if(_t(r,e.next))return e.next;if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){const u=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=n&&u>i&&(i=u,o=e.x<e.next.x?e:e.next,u===n))return o}e=e.next}while(e!==t);if(!o)return null;const a=o,c=o.x,l=o.y;let h=1/0;e=o;do{if(n>=e.x&&e.x>=c&&n!==e.x&&Ke(s<l?n:i,s,c,l,s<l?i:n,s,e.x,e.y)){const u=Math.abs(s-e.y)/(n-e.x);Gt(e,r)&&(u<h||u===h&&(e.x>o.x||e.x===o.x&&es(o,e)))&&(o=e,h=u)}e=e.next}while(e!==a);return o}function es(r,t){return L(r.prev,r,t.prev)<0&&L(t.next,r,r.next)<0}function ns(r,t,e,n){let s=r;do s.z===0&&(s.z=te(s.x,s.y,t,e,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,ss(s)}function ss(r){let t,e=1;do{let n=r,s;r=null;let i=null;for(t=0;n;){t++;let o=n,a=0;for(let l=0;l<e&&(a++,o=o.nextZ,!!o);l++);let c=e;for(;a>0||c>0&&o;)a!==0&&(c===0||!o||n.z<=o.z)?(s=n,n=n.nextZ,a--):(s=o,o=o.nextZ,c--),i?i.nextZ=s:r=s,s.prevZ=i,i=s;n=o}i.nextZ=null,e*=2}while(t>1);return r}function te(r,t,e,n,s){return r=(r-e)*s|0,t=(t-n)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function rs(r){let t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Ke(r,t,e,n,s,i,o,a){return(s-o)*(t-a)>=(r-o)*(i-a)&&(r-o)*(n-a)>=(e-o)*(t-a)&&(e-o)*(i-a)>=(s-o)*(n-a)}function Tt(r,t,e,n,s,i,o,a){return!(r===o&&t===a)&&Ke(r,t,e,n,s,i,o,a)}function is(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!os(r,t)&&(Gt(r,t)&&Gt(t,r)&&as(r,t)&&(L(r.prev,r,t.prev)||L(r,t.prev,t))||_t(r,t)&&L(r.prev,r,r.next)>0&&L(t.prev,t,t.next)>0)}function L(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function _t(r,t){return r.x===t.x&&r.y===t.y}function Je(r,t,e,n){const s=zt(L(r,t,e)),i=zt(L(r,t,n)),o=zt(L(e,n,r)),a=zt(L(e,n,t));return!!(s!==i&&o!==a||s===0&&Wt(r,e,t)||i===0&&Wt(r,n,t)||o===0&&Wt(e,r,n)||a===0&&Wt(e,t,n))}function Wt(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function zt(r){return r>0?1:r<0?-1:0}function os(r,t){let e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&Je(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Gt(r,t){return L(r.prev,r,r.next)<0?L(r,t,r.next)>=0&&L(r,r.prev,t)>=0:L(r,t,r.prev)<0||L(r,r.next,t)<0}function as(r,t){let e=r,n=!1;const s=(r.x+t.x)/2,i=(r.y+t.y)/2;do e.y>i!=e.next.y>i&&e.next.y!==e.y&&s<(e.next.x-e.x)*(i-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==r);return n}function tn(r,t){const e=ee(r.i,r.x,r.y),n=ee(t.i,t.x,t.y),s=r.next,i=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,n.next=e,e.prev=n,i.next=n,n.prev=i,n}function Te(r,t,e,n){const s=ee(r,t,e);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function At(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function ee(r,t,e){return{i:r,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function cs(r,t,e,n){let s=0;for(let i=t,o=e-n;i<e;i+=n)s+=(r[o]-r[i])*(r[i+1]+r[o+1]),o=i;return s}const hs=ve.default||ve;var Xt,ke;function ls(){if(ke)return Xt;ke=1,Xt=e;var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function e(i){var o=[];return i.replace(t,function(a,c,l){var h=c.toLowerCase();for(l=s(l),h=="m"&&l.length>2&&(o.push([c].concat(l.splice(0,2))),h="l",c=c=="m"?"l":"L");;){if(l.length==r[h])return l.unshift(c),o.push(l);if(l.length<r[h])throw new Error("malformed path data");o.push([c].concat(l.splice(0,r[h])))}}),o}var n=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function s(i){var o=i.match(n);return o?o.map(Number):[]}return Xt}var us=ls();const ds=wn(us);function fs(r,t){const e=ds(r),n=[];let s=null,i=0,o=0;for(let a=0;a<e.length;a++){const c=e[a],l=c[0],h=c;switch(l){case"M":i=h[1],o=h[2],t.moveTo(i,o);break;case"m":i+=h[1],o+=h[2],t.moveTo(i,o);break;case"H":i=h[1],t.lineTo(i,o);break;case"h":i+=h[1],t.lineTo(i,o);break;case"V":o=h[1],t.lineTo(i,o);break;case"v":o+=h[1],t.lineTo(i,o);break;case"L":i=h[1],o=h[2],t.lineTo(i,o);break;case"l":i+=h[1],o+=h[2],t.lineTo(i,o);break;case"C":i=h[5],o=h[6],t.bezierCurveTo(h[1],h[2],h[3],h[4],i,o);break;case"c":t.bezierCurveTo(i+h[1],o+h[2],i+h[3],o+h[4],i+h[5],o+h[6]),i+=h[5],o+=h[6];break;case"S":i=h[3],o=h[4],t.bezierCurveToShort(h[1],h[2],i,o);break;case"s":t.bezierCurveToShort(i+h[1],o+h[2],i+h[3],o+h[4]),i+=h[3],o+=h[4];break;case"Q":i=h[3],o=h[4],t.quadraticCurveTo(h[1],h[2],i,o);break;case"q":t.quadraticCurveTo(i+h[1],o+h[2],i+h[3],o+h[4]),i+=h[3],o+=h[4];break;case"T":i=h[1],o=h[2],t.quadraticCurveToShort(i,o);break;case"t":i+=h[1],o+=h[2],t.quadraticCurveToShort(i,o);break;case"A":i=h[6],o=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],i,o);break;case"a":i+=h[6],o+=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],i,o);break;case"Z":case"z":t.closePath(),n.length>0&&(s=n.pop(),s?(i=s.startX,o=s.startY):(i=0,o=0)),s=null;break;default:Ft(`Unknown SVG path command: ${l}`)}l!=="Z"&&l!=="z"&&s===null&&(s={startX:i,startY:o},n.push(s))}return t}class ae{constructor(t=0,e=0,n=0){this.type="circle",this.x=t,this.y=e,this.radius=n}clone(){return new ae(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const n=this.radius*this.radius;let s=this.x-t,i=this.y-e;return s*=s,i*=i,s+i<=n}strokeContains(t,e,n,s=.5){if(this.radius===0)return!1;const i=this.x-t,o=this.y-e,a=this.radius,c=(1-s)*n,l=Math.sqrt(i*i+o*o);return l<=a+c&&l>a-(n-c)}getBounds(t){return t||(t=new dt),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class ce{constructor(t=0,e=0,n=0,s=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=n,this.halfHeight=s}clone(){return new ce(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let n=(t-this.x)/this.halfWidth,s=(e-this.y)/this.halfHeight;return n*=n,s*=s,n+s<=1}strokeContains(t,e,n,s=.5){const{halfWidth:i,halfHeight:o}=this;if(i<=0||o<=0)return!1;const a=n*(1-s),c=n-a,l=i-c,h=o-c,u=i+a,f=o+a,d=t-this.x,p=e-this.y,x=d*d/(l*l)+p*p/(h*h),g=d*d/(u*u)+p*p/(f*f);return x>1&&g<=1}getBounds(t){return t||(t=new dt),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function ps(r,t,e,n,s,i){const o=r-e,a=t-n,c=s-e,l=i-n,h=o*c+a*l,u=c*c+l*l;let f=-1;u!==0&&(f=h/u);let d,p;f<0?(d=e,p=n):f>1?(d=s,p=i):(d=e+f*c,p=n+f*l);const x=r-d,g=t-p;return x*x+g*g}let xs,gs;class It{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const n=[];for(let s=0,i=e.length;s<i;s++)n.push(e[s].x,e[s].y);e=n}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,n=e.length;for(let s=0;s<n;s+=2){const i=e[s],o=e[s+1],a=e[(s+2)%n],c=e[(s+3)%n];t+=(a-i)*(c+o)}return t<0}containsPolygon(t){const e=this.getBounds(xs),n=t.getBounds(gs);if(!e.containsRect(n))return!1;const s=t.points;for(let i=0;i<s.length;i+=2){const o=s[i],a=s[i+1];if(!this.contains(o,a))return!1}return!0}clone(){const t=this.points.slice(),e=new It(t);return e.closePath=this.closePath,e}contains(t,e){let n=!1;const s=this.points.length/2;for(let i=0,o=s-1;i<s;o=i++){const a=this.points[i*2],c=this.points[i*2+1],l=this.points[o*2],h=this.points[o*2+1];c>e!=h>e&&t<(l-a)*((e-c)/(h-c))+a&&(n=!n)}return n}strokeContains(t,e,n,s=.5){const i=n*n,o=i*(1-s),a=i-o,{points:c}=this,l=c.length-(this.closePath?0:2);for(let h=0;h<l;h+=2){const u=c[h],f=c[h+1],d=c[(h+2)%c.length],p=c[(h+3)%c.length],x=ps(t,e,u,f,d,p),g=Math.sign((d-u)*(e-f)-(p-f)*(t-u));if(x<=(g<0?a:o))return!0}return!1}getBounds(t){t||(t=new dt);const e=this.points;let n=1/0,s=-1/0,i=1/0,o=-1/0;for(let a=0,c=e.length;a<c;a+=2){const l=e[a],h=e[a+1];n=l<n?l:n,s=l>s?l:s,i=h<i?h:i,o=h>o?h:o}return t.x=n,t.width=s-n,t.y=i,t.height=o-i,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return N("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return N("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const qt=(r,t,e,n,s,i,o)=>{const a=r-e,c=t-n,l=Math.sqrt(a*a+c*c);return l>=s-i&&l<=s+o};class he{constructor(t=0,e=0,n=0,s=0,i=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=n,this.height=s,this.radius=i}getBounds(t){return t||(t=new dt),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new he(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+n&&e<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let s=t-(this.x+n),i=e-(this.y+n);const o=n*n;if(s*s+i*i<=o||(s=t-(this.x+this.width-n),s*s+i*i<=o)||(i=e-(this.y+this.height-n),s*s+i*i<=o)||(s=t-(this.x+n),s*s+i*i<=o))return!0}return!1}strokeContains(t,e,n,s=.5){const{x:i,y:o,width:a,height:c,radius:l}=this,h=n*(1-s),u=n-h,f=i+l,d=o+l,p=a-l*2,x=c-l*2,g=i+a,b=o+c;return(t>=i-h&&t<=i+u||t>=g-u&&t<=g+h)&&e>=d&&e<=d+x||(e>=o-h&&e<=o+u||e>=b-u&&e<=b+h)&&t>=f&&t<=f+p?!0:t<f&&e<d&&qt(t,e,f,d,l,u,h)||t>g-l&&e<d&&qt(t,e,g-l,d,l,u,h)||t>g-l&&e>b-l&&qt(t,e,g-l,b-l,l,u,h)||t<f&&e>b-l&&qt(t,e,f,b-l,l,u,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}function ys(r,t,e,n,s,i,o,a=null){let c=0;e*=t,s*=i;const l=a.a,h=a.b,u=a.c,f=a.d,d=a.tx,p=a.ty;for(;c<o;){const x=r[e],g=r[e+1];n[s]=l*x+u*g+d,n[s+1]=h*x+f*g+p,s+=i,e+=t,c++}}function ms(r,t,e,n){let s=0;for(t*=e;s<n;)r[t]=0,r[t+1]=0,t+=e,s++}function en(r,t,e,n,s){const i=t.a,o=t.b,a=t.c,c=t.d,l=t.tx,h=t.ty;e||(e=0),n||(n=2),s||(s=r.length/n-e);let u=e*n;for(let f=0;f<s;f++){const d=r[u],p=r[u+1];r[u]=i*d+a*p+l,r[u+1]=o*d+c*p+h,u+=n}}const _s=new U;class le{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,n=this.renderable;return n?wt(e,n.groupColor)+(this.alpha*n.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||_s}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Bt={extension:{type:z.ShapeBuilder,name:"circle"},build(r,t){let e,n,s,i,o,a;if(r.type==="circle"){const m=r;if(o=a=m.radius,o<=0)return!1;e=m.x,n=m.y,s=i=0}else if(r.type==="ellipse"){const m=r;if(o=m.halfWidth,a=m.halfHeight,o<=0||a<=0)return!1;e=m.x,n=m.y,s=i=0}else{const m=r,k=m.width/2,_=m.height/2;e=m.x+k,n=m.y+_,o=a=Math.max(0,Math.min(m.radius,Math.min(k,_))),s=k-o,i=_-a}if(s<0||i<0)return!1;const c=Math.ceil(2.3*Math.sqrt(o+a)),l=c*8+(s?4:0)+(i?4:0);if(l===0)return!1;if(c===0)return t[0]=t[6]=e+s,t[1]=t[3]=n+i,t[2]=t[4]=e-s,t[5]=t[7]=n-i,!0;let h=0,u=c*4+(s?2:0)+2,f=u,d=l,p=s+o,x=i,g=e+p,b=e-p,y=n+x;if(t[h++]=g,t[h++]=y,t[--u]=y,t[--u]=b,i){const m=n-x;t[f++]=b,t[f++]=m,t[--d]=m,t[--d]=g}for(let m=1;m<c;m++){const k=Math.PI/2*(m/c),_=s+Math.cos(k)*o,C=i+Math.sin(k)*a,D=e+_,I=e-_,v=n+C,M=n-C;t[h++]=D,t[h++]=v,t[--u]=v,t[--u]=I,t[f++]=I,t[f++]=M,t[--d]=M,t[--d]=D}p=s,x=i+a,g=e+p,b=e-p,y=n+x;const P=n-x;return t[h++]=g,t[h++]=y,t[--d]=P,t[--d]=g,s&&(t[h++]=b,t[h++]=y,t[--d]=P,t[--d]=b),!0},triangulate(r,t,e,n,s,i){if(r.length===0)return;let o=0,a=0;for(let h=0;h<r.length;h+=2)o+=r[h],a+=r[h+1];o/=r.length/2,a/=r.length/2;let c=n;t[c*e]=o,t[c*e+1]=a;const l=c++;for(let h=0;h<r.length;h+=2)t[c*e]=r[h],t[c*e+1]=r[h+1],h>0&&(s[i++]=c,s[i++]=l,s[i++]=c-1),c++;s[i++]=l+1,s[i++]=l,s[i++]=c-1}},bs={...Bt,extension:{...Bt.extension,name:"ellipse"}},Cs={...Bt,extension:{...Bt.extension,name:"roundedRectangle"}},nn=1e-4,we=1e-4;function Ps(r){const t=r.length;if(t<6)return 1;let e=0;for(let n=0,s=r[t-2],i=r[t-1];n<t;n+=2){const o=r[n],a=r[n+1];e+=(o-s)*(a+i),s=o,i=a}return e<0?-1:1}function Ie(r,t,e,n,s,i,o,a){const c=r-e*s,l=t-n*s,h=r+e*i,u=t+n*i;let f,d;o?(f=n,d=-e):(f=-n,d=e);const p=c+f,x=l+d,g=h+f,b=u+d;return a.push(p,x),a.push(g,b),2}function ft(r,t,e,n,s,i,o,a){const c=e-r,l=n-t;let h=Math.atan2(c,l),u=Math.atan2(s-r,i-t);a&&h<u?h+=Math.PI*2:!a&&h>u&&(u+=Math.PI*2);let f=h;const d=u-h,p=Math.abs(d),x=Math.sqrt(c*c+l*l),g=(15*p*Math.sqrt(x)/Math.PI>>0)+1,b=d/g;if(f+=b,a){o.push(r,t),o.push(e,n);for(let y=1,P=f;y<g;y++,P+=b)o.push(r,t),o.push(r+Math.sin(P)*x,t+Math.cos(P)*x);o.push(r,t),o.push(s,i)}else{o.push(e,n),o.push(r,t);for(let y=1,P=f;y<g;y++,P+=b)o.push(r+Math.sin(P)*x,t+Math.cos(P)*x),o.push(r,t);o.push(s,i),o.push(r,t)}return g*2}function sn(r,t,e,n,s,i){const o=nn;if(r.length===0)return;const a=t;let c=a.alignment;if(t.alignment!==.5){let G=Ps(r);c=(c-.5)*G+.5}const l=new mt(r[0],r[1]),h=new mt(r[r.length-2],r[r.length-1]),u=n,f=Math.abs(l.x-h.x)<o&&Math.abs(l.y-h.y)<o;if(u){r=r.slice(),f&&(r.pop(),r.pop(),h.set(r[r.length-2],r[r.length-1]));const G=(l.x+h.x)*.5,E=(h.y+l.y)*.5;r.unshift(G,E),r.push(G,E)}const d=s,p=r.length/2;let x=r.length;const g=d.length/2,b=a.width/2,y=b*b,P=a.miterLimit*a.miterLimit;let m=r[0],k=r[1],_=r[2],C=r[3],D=0,I=0,v=-(k-C),M=m-_,w=0,R=0,F=Math.sqrt(v*v+M*M);v/=F,M/=F,v*=b,M*=b;const Z=c,S=(1-Z)*2,T=Z*2;u||(a.cap==="round"?x+=ft(m-v*(S-T)*.5,k-M*(S-T)*.5,m-v*S,k-M*S,m+v*T,k+M*T,d,!0)+2:a.cap==="square"&&(x+=Ie(m,k,v,M,S,T,!0,d))),d.push(m-v*S,k-M*S),d.push(m+v*T,k+M*T);for(let G=1;G<p-1;++G){m=r[(G-1)*2],k=r[(G-1)*2+1],_=r[G*2],C=r[G*2+1],D=r[(G+1)*2],I=r[(G+1)*2+1],v=-(k-C),M=m-_,F=Math.sqrt(v*v+M*M),v/=F,M/=F,v*=b,M*=b,w=-(C-I),R=_-D,F=Math.sqrt(w*w+R*R),w/=F,R/=F,w*=b,R*=b;const E=_-m,X=k-C,O=_-D,V=I-C,j=E*O+X*V,A=X*O-V*E,it=A<0;if(Math.abs(A)<.001*Math.abs(j)){d.push(_-v*S,C-M*S),d.push(_+v*T,C+M*T),j>=0&&(a.join==="round"?x+=ft(_,C,_-v*S,C-M*S,_-w*S,C-R*S,d,!1)+4:x+=2,d.push(_-w*T,C-R*T),d.push(_+w*S,C+R*S));continue}const Lt=(-v+m)*(-M+C)-(-v+_)*(-M+k),Ct=(-w+D)*(-R+C)-(-w+_)*(-R+I),Pt=(E*Ct-O*Lt)/A,ht=(V*Lt-X*Ct)/A,lt=(Pt-_)*(Pt-_)+(ht-C)*(ht-C),Y=_+(Pt-_)*S,Q=C+(ht-C)*S,K=_-(Pt-_)*T,J=C-(ht-C)*T,ut=Math.min(E*E+X*X,O*O+V*V),ot=it?S:T,Mt=ut+ot*ot*y;lt<=Mt?a.join==="bevel"||lt/y>P?(it?(d.push(Y,Q),d.push(_+v*T,C+M*T),d.push(Y,Q),d.push(_+w*T,C+R*T)):(d.push(_-v*S,C-M*S),d.push(K,J),d.push(_-w*S,C-R*S),d.push(K,J)),x+=2):a.join==="round"?it?(d.push(Y,Q),d.push(_+v*T,C+M*T),x+=ft(_,C,_+v*T,C+M*T,_+w*T,C+R*T,d,!0)+4,d.push(Y,Q),d.push(_+w*T,C+R*T)):(d.push(_-v*S,C-M*S),d.push(K,J),x+=ft(_,C,_-v*S,C-M*S,_-w*S,C-R*S,d,!1)+4,d.push(_-w*S,C-R*S),d.push(K,J)):(d.push(Y,Q),d.push(K,J)):(d.push(_-v*S,C-M*S),d.push(_+v*T,C+M*T),a.join==="round"?it?x+=ft(_,C,_+v*T,C+M*T,_+w*T,C+R*T,d,!0)+2:x+=ft(_,C,_-v*S,C-M*S,_-w*S,C-R*S,d,!1)+2:a.join==="miter"&&lt/y<=P&&(it?(d.push(K,J),d.push(K,J)):(d.push(Y,Q),d.push(Y,Q)),x+=2),d.push(_-w*S,C-R*S),d.push(_+w*T,C+R*T),x+=2)}m=r[(p-2)*2],k=r[(p-2)*2+1],_=r[(p-1)*2],C=r[(p-1)*2+1],v=-(k-C),M=m-_,F=Math.sqrt(v*v+M*M),v/=F,M/=F,v*=b,M*=b,d.push(_-v*S,C-M*S),d.push(_+v*T,C+M*T),u||(a.cap==="round"?x+=ft(_-v*(S-T)*.5,C-M*(S-T)*.5,_-v*S,C-M*S,_+v*T,C+M*T,d,!1)+2:a.cap==="square"&&(x+=Ie(_,C,v,M,S,T,!1,d)));const q=we*we;for(let G=g;G<x+g-2;++G)m=d[G*2],k=d[G*2+1],_=d[(G+1)*2],C=d[(G+1)*2+1],D=d[(G+2)*2],I=d[(G+2)*2+1],!(Math.abs(m*(C-I)+_*(I-k)+D*(k-C))<q)&&i.push(G,G+1,G+2)}function Ms(r,t,e,n){const s=nn;if(r.length===0)return;const i=r[0],o=r[1],a=r[r.length-2],c=r[r.length-1],l=t||Math.abs(i-a)<s&&Math.abs(o-c)<s,h=e,u=r.length/2,f=h.length/2;for(let d=0;d<u;d++)h.push(r[d*2]),h.push(r[d*2+1]);for(let d=0;d<u-1;d++)n.push(f+d,f+d+1);l&&n.push(f+u-1,f)}function rn(r,t,e,n,s,i,o){const a=hs(r,t,2);if(!a)return;for(let l=0;l<a.length;l+=3)i[o++]=a[l]+s,i[o++]=a[l+1]+s,i[o++]=a[l+2]+s;let c=s*n;for(let l=0;l<r.length;l+=2)e[c]=r[l],e[c+1]=r[l+1],c+=n}const Ss=[],vs={extension:{type:z.ShapeBuilder,name:"polygon"},build(r,t){for(let e=0;e<r.points.length;e++)t[e]=r.points[e];return!0},triangulate(r,t,e,n,s,i){rn(r,Ss,t,e,n,s,i)}},Ts={extension:{type:z.ShapeBuilder,name:"rectangle"},build(r,t){const e=r,n=e.x,s=e.y,i=e.width,o=e.height;return i>0&&o>0?(t[0]=n,t[1]=s,t[2]=n+i,t[3]=s,t[4]=n+i,t[5]=s+o,t[6]=n,t[7]=s+o,!0):!1},triangulate(r,t,e,n,s,i){let o=0;n*=e,t[n+o]=r[0],t[n+o+1]=r[1],o+=e,t[n+o]=r[2],t[n+o+1]=r[3],o+=e,t[n+o]=r[6],t[n+o+1]=r[7],o+=e,t[n+o]=r[4],t[n+o+1]=r[5],o+=e;const a=n/e;s[i++]=a,s[i++]=a+1,s[i++]=a+2,s[i++]=a+1,s[i++]=a+3,s[i++]=a+2}},ks={extension:{type:z.ShapeBuilder,name:"triangle"},build(r,t){return t[0]=r.x,t[1]=r.y,t[2]=r.x2,t[3]=r.y2,t[4]=r.x3,t[5]=r.y3,!0},triangulate(r,t,e,n,s,i){let o=0;n*=e,t[n+o]=r[0],t[n+o+1]=r[1],o+=e,t[n+o]=r[2],t[n+o+1]=r[3],o+=e,t[n+o]=r[4],t[n+o+1]=r[5];const a=n/e;s[i++]=a,s[i++]=a+1,s[i++]=a+2}},Re=[{offset:0,color:"white"},{offset:1,color:"black"}],ue=class ne{constructor(...t){this.uid=Nt("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=ws(t);e={...e.type==="radial"?ne.defaultRadialOptions:ne.defaultLinearOptions,...In(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(s=>{this.addColorStop(s.offset,s.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:$.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:n,y:s}=this.end,i=n-t,o=s-e;const a=i<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(i<0){const g=t;t=n,n=g,i*=-1}if(o<0){const g=e;e=s,s=g,o*=-1}}const c=this.colorStops.length?this.colorStops:Re,l=this._textureSize,{canvas:h,context:u}=Ge(l,1),f=a?u.createLinearGradient(this._textureSize,0,0,0):u.createLinearGradient(0,0,this._textureSize,0);De(f,c),u.fillStyle=f,u.fillRect(0,0,l,1),this.texture=new ct({source:new Se({resource:h,addressMode:this._wrapMode})});const d=Math.sqrt(i*i+o*o),p=Math.atan2(o,i),x=new U;x.scale(d/l,1),x.rotate(p),x.translate(t,e),this.textureSpace==="local"&&x.scale(l,l),this.transform=x}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Re,e=this._textureSize,{canvas:n,context:s}=Ge(e,e),{x:i,y:o}=this.center,{x:a,y:c}=this.outerCenter,l=this.innerRadius,h=this.outerRadius,u=a-h,f=c-h,d=e/(h*2),p=(i-u)*d,x=(o-f)*d,g=s.createRadialGradient(p,x,l*d,(a-u)*d,(c-f)*d,h*d);De(g,t),s.fillStyle=t[t.length-1].color,s.fillRect(0,0,e,e),s.fillStyle=g,s.translate(p,x),s.rotate(this.rotation),s.scale(1,this.scale),s.translate(-p,-x),s.fillRect(0,0,e,e),this.texture=new ct({source:new Se({resource:n,addressMode:this._wrapMode})});const b=new U;b.scale(1/d,1/d),b.translate(u,f),this.textureSpace==="local"&&b.scale(e,e),this.transform=b}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};ue.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};ue.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let bt=ue;function De(r,t){for(let e=0;e<t.length;e++){const n=t[e];r.addColorStop(n.offset,n.color)}}function Ge(r,t){const e=st.get().createCanvas(r,t),n=e.getContext("2d");return{canvas:e,context:n}}function ws(r){let t=r[0]??{};return(typeof t=="number"||r[1])&&(N("8.5.2","use options object instead"),t={type:"linear",start:{x:r[0],y:r[1]},end:{x:r[2],y:r[3]},textureSpace:r[4],textureSize:r[5]??bt.defaultLinearOptions.textureSize}),t}const Is=new U,Rs=new dt;function on(r,t,e,n){const s=t.matrix?r.copyFrom(t.matrix).invert():r.identity();if(t.textureSpace==="local"){const o=e.getBounds(Rs);t.width&&o.pad(t.width);const{x:a,y:c}=o,l=1/o.width,h=1/o.height,u=-a*l,f=-c*h,d=s.a,p=s.b,x=s.c,g=s.d;s.a*=l,s.b*=l,s.c*=h,s.d*=h,s.tx=u*d+f*x+s.tx,s.ty=u*p+f*g+s.ty}else s.translate(t.texture.frame.x,t.texture.frame.y),s.scale(1/t.texture.source.width,1/t.texture.source.height);const i=t.texture.source.style;return!(t.fill instanceof bt)&&i.addressMode==="clamp-to-edge"&&(i.addressMode="repeat",i.update()),n&&s.append(Is.copyFrom(n).invert()),s}const Ht={};rt.handleByMap(z.ShapeBuilder,Ht);rt.add(Ts,vs,ks,Bt,bs,Cs);const Ds=new dt,Gs=new U;function As(r,t){const{geometryData:e,batches:n}=t;n.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let s=0;s<r.instructions.length;s++){const i=r.instructions[s];if(i.action==="texture")Bs(i.data,n,e);else if(i.action==="fill"||i.action==="stroke"){const o=i.action==="stroke",a=i.data.path.shapePath,c=i.data.style,l=i.data.hole;o&&l&&Ae(l.shapePath,c,!0,n,e),l&&(a.shapePrimitives[a.shapePrimitives.length-1].holes=l.shapePath.shapePrimitives),Ae(a,c,o,n,e)}}}function Bs(r,t,e){const n=[],s=Ht.rectangle,i=Ds;i.x=r.dx,i.y=r.dy,i.width=r.dw,i.height=r.dh;const o=r.transform;if(!s.build(i,n))return;const{vertices:a,uvs:c,indices:l}=e,h=l.length,u=a.length/2;o&&en(n,o),s.triangulate(n,a,2,u,l,h);const f=r.image,d=f.uvs;c.push(d.x0,d.y0,d.x1,d.y1,d.x3,d.y3,d.x2,d.y2);const p=xt.get(le);p.indexOffset=h,p.indexSize=l.length-h,p.attributeOffset=u,p.attributeSize=a.length/2-u,p.baseColor=r.style,p.alpha=r.alpha,p.texture=f,p.geometryData=e,t.push(p)}function Ae(r,t,e,n,s){const{vertices:i,uvs:o,indices:a}=s;r.shapePrimitives.forEach(({shape:c,transform:l,holes:h})=>{const u=[],f=Ht[c.type];if(!f.build(c,u))return;const d=a.length,p=i.length/2;let x="triangle-list";if(l&&en(u,l),e){const P=c.closePath??!0,m=t;m.pixelLine?(Ms(u,P,i,a),x="line-list"):sn(u,m,!1,P,i,a)}else if(h){const P=[],m=u.slice();Fs(h).forEach(_=>{P.push(m.length/2),m.push(..._)}),rn(m,P,i,2,p,a,d)}else f.triangulate(u,i,2,p,a,d);const g=o.length/2,b=t.texture;if(b!==ct.WHITE){const P=on(Gs,t,c,l);ys(i,2,p,o,g,2,i.length/2-p,P)}else ms(o,g,2,i.length/2-p);const y=xt.get(le);y.indexOffset=d,y.indexSize=a.length-d,y.attributeOffset=p,y.attributeSize=i.length/2-p,y.baseColor=t.color,y.alpha=t.alpha,y.texture=b,y.geometryData=s,y.topology=x,n.push(y)})}function Fs(r){const t=[];for(let e=0;e<r.length;e++){const n=r[e].shape,s=[];Ht[n.type].build(n,s)&&t.push(s)}return t}class Hs{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}reset(){this.batches&&this.batches.forEach(t=>{xt.return(t)}),this.graphicsData&&xt.return(this.graphicsData),this.isBatchable=!1,this.context=null,this.batches.length=0,this.geometryData.indices.length=0,this.geometryData.vertices.length=0,this.geometryData.uvs.length=0,this.graphicsData=null}destroy(){this.reset(),this.batches=null,this.geometryData=null}}class Ls{constructor(){this.instructions=new Ze}init(t){const e=t.maxTextures;this.batcher?this.batcher._updateMaxTextures(e):this.batcher=new Fn({maxTextures:e}),this.instructions.reset()}get geometry(){return N(Rn,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const de=class se{constructor(t){this._renderer=t,this._managedContexts=new $t({renderer:t,type:"resource",name:"graphicsContext"})}init(t){se.defaultOptions.bezierSmoothness=t?.bezierSmoothness??se.defaultOptions.bezierSmoothness}getContextRenderData(t){return t._gpuData[this._renderer.uid].graphicsData||this._initContextRenderData(t)}updateGpuContext(t){const e=!!t._gpuData[this._renderer.uid],n=t._gpuData[this._renderer.uid]||this._initContext(t);if(t.dirty||!e){e&&n.reset(),As(t,n);const s=t.batchMode;t.customShader||s==="no-batch"?n.isBatchable=!1:s==="auto"?n.isBatchable=n.geometryData.vertices.length<400:n.isBatchable=!0,t.dirty=!1}return n}getGpuContext(t){return t._gpuData[this._renderer.uid]||this._initContext(t)}_initContextRenderData(t){const e=xt.get(Ls,{maxTextures:this._renderer.limits.maxBatchableTextures}),n=t._gpuData[this._renderer.uid],{batches:s,geometryData:i}=n;n.graphicsData=e;const o=i.vertices.length,a=i.indices.length;for(let u=0;u<s.length;u++)s[u].applyTransform=!1;const c=e.batcher;c.ensureAttributeBuffer(o),c.ensureIndexBuffer(a),c.begin();for(let u=0;u<s.length;u++){const f=s[u];c.add(f)}c.finish(e.instructions);const l=c.geometry;l.indexBuffer.setDataWithSize(c.indexBuffer,c.indexSize,!0),l.buffers[0].setDataWithSize(c.attributeBuffer.float32View,c.attributeSize,!0);const h=c.batches;for(let u=0;u<h.length;u++){const f=h[u];f.bindGroup=Nn(f.textures.textures,f.textures.count,this._renderer.limits.maxBatchableTextures)}return e}_initContext(t){const e=new Hs;return e.context=t,t._gpuData[this._renderer.uid]=e,this._managedContexts.add(t),e}destroy(){this._managedContexts.destroy(),this._renderer=null}};de.extension={type:[z.WebGLSystem,z.WebGPUSystem],name:"graphicsContext"};de.defaultOptions={bezierSmoothness:.5};let fe=de;const Ws=8,Et=11920929e-14,zs=1;function an(r,t,e,n,s,i,o,a,c,l){const u=Math.min(.99,Math.max(0,l??fe.defaultOptions.bezierSmoothness));let f=(zs-u)/1;return f*=f,qs(t,e,n,s,i,o,a,c,r,f),r}function qs(r,t,e,n,s,i,o,a,c,l){re(r,t,e,n,s,i,o,a,c,l,0),c.push(o,a)}function re(r,t,e,n,s,i,o,a,c,l,h){if(h>Ws)return;const u=(r+e)/2,f=(t+n)/2,d=(e+s)/2,p=(n+i)/2,x=(s+o)/2,g=(i+a)/2,b=(u+d)/2,y=(f+p)/2,P=(d+x)/2,m=(p+g)/2,k=(b+P)/2,_=(y+m)/2;if(h>0){let C=o-r,D=a-t;const I=Math.abs((e-o)*D-(n-a)*C),v=Math.abs((s-o)*D-(i-a)*C);if(I>Et&&v>Et){if((I+v)*(I+v)<=l*(C*C+D*D)){c.push(k,_);return}}else if(I>Et){if(I*I<=l*(C*C+D*D)){c.push(k,_);return}}else if(v>Et){if(v*v<=l*(C*C+D*D)){c.push(k,_);return}}else if(C=k-(r+o)/2,D=_-(t+a)/2,C*C+D*D<=l){c.push(k,_);return}}re(r,t,u,f,b,y,k,_,c,l,h+1),re(k,_,P,m,x,g,o,a,c,l,h+1)}const Es=8,Us=11920929e-14,Vs=1;function js(r,t,e,n,s,i,o,a){const l=Math.min(.99,Math.max(0,a??fe.defaultOptions.bezierSmoothness));let h=(Vs-l)/1;return h*=h,Ns(t,e,n,s,i,o,r,h),r}function Ns(r,t,e,n,s,i,o,a){ie(o,r,t,e,n,s,i,a,0),o.push(s,i)}function ie(r,t,e,n,s,i,o,a,c){if(c>Es)return;const l=(t+n)/2,h=(e+s)/2,u=(n+i)/2,f=(s+o)/2,d=(l+u)/2,p=(h+f)/2;let x=i-t,g=o-e;const b=Math.abs((n-i)*g-(s-o)*x);if(b>Us){if(b*b<=a*(x*x+g*g)){r.push(d,p);return}}else if(x=d-(t+i)/2,g=p-(e+o)/2,x*x+g*g<=a){r.push(d,p);return}ie(r,t,e,l,h,d,p,a,c+1),ie(r,d,p,u,f,i,o,a,c+1)}function cn(r,t,e,n,s,i,o,a){let c=Math.abs(s-i);(!o&&s>i||o&&i>s)&&(c=2*Math.PI-c),a||(a=Math.max(6,Math.floor(6*Math.pow(n,1/3)*(c/Math.PI)))),a=Math.max(a,3);let l=c/a,h=s;l*=o?-1:1;for(let u=0;u<a+1;u++){const f=Math.cos(h),d=Math.sin(h),p=t+f*n,x=e+d*n;r.push(p,x),h+=l}}function $s(r,t,e,n,s,i){const o=r[r.length-2],c=r[r.length-1]-e,l=o-t,h=s-e,u=n-t,f=Math.abs(c*u-l*h);if(f<1e-8||i===0){(r[r.length-2]!==t||r[r.length-1]!==e)&&r.push(t,e);return}const d=c*c+l*l,p=h*h+u*u,x=c*h+l*u,g=i*Math.sqrt(d)/f,b=i*Math.sqrt(p)/f,y=g*x/d,P=b*x/p,m=g*u+b*l,k=g*h+b*c,_=l*(b+y),C=c*(b+y),D=u*(g+P),I=h*(g+P),v=Math.atan2(C-k,_-m),M=Math.atan2(I-k,D-m);cn(r,m+t,k+e,i,v,M,l*h>u*c)}const Rt=Math.PI*2,Qt={centerX:0,centerY:0,ang1:0,ang2:0},Kt=({x:r,y:t},e,n,s,i,o,a,c)=>{r*=e,t*=n;const l=s*r-i*t,h=i*r+s*t;return c.x=l+o,c.y=h+a,c};function Zs(r,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),n=t===1.5707963267948966?.551915024494:e,s=Math.cos(r),i=Math.sin(r),o=Math.cos(r+t),a=Math.sin(r+t);return[{x:s-i*n,y:i+s*n},{x:o+a*n,y:a-o*n},{x:o,y:a}]}const Be=(r,t,e,n)=>{const s=r*n-t*e<0?-1:1;let i=r*e+t*n;return i>1&&(i=1),i<-1&&(i=-1),s*Math.acos(i)},Os=(r,t,e,n,s,i,o,a,c,l,h,u,f)=>{const d=Math.pow(s,2),p=Math.pow(i,2),x=Math.pow(h,2),g=Math.pow(u,2);let b=d*p-d*g-p*x;b<0&&(b=0),b/=d*g+p*x,b=Math.sqrt(b)*(o===a?-1:1);const y=b*s/i*u,P=b*-i/s*h,m=l*y-c*P+(r+e)/2,k=c*y+l*P+(t+n)/2,_=(h-y)/s,C=(u-P)/i,D=(-h-y)/s,I=(-u-P)/i,v=Be(1,0,_,C);let M=Be(_,C,D,I);a===0&&M>0&&(M-=Rt),a===1&&M<0&&(M+=Rt),f.centerX=m,f.centerY=k,f.ang1=v,f.ang2=M};function Ys(r,t,e,n,s,i,o,a=0,c=0,l=0){if(i===0||o===0)return;const h=Math.sin(a*Rt/360),u=Math.cos(a*Rt/360),f=u*(t-n)/2+h*(e-s)/2,d=-h*(t-n)/2+u*(e-s)/2;if(f===0&&d===0)return;i=Math.abs(i),o=Math.abs(o);const p=Math.pow(f,2)/Math.pow(i,2)+Math.pow(d,2)/Math.pow(o,2);p>1&&(i*=Math.sqrt(p),o*=Math.sqrt(p)),Os(t,e,n,s,i,o,c,l,h,u,f,d,Qt);let{ang1:x,ang2:g}=Qt;const{centerX:b,centerY:y}=Qt;let P=Math.abs(g)/(Rt/4);Math.abs(1-P)<1e-7&&(P=1);const m=Math.max(Math.ceil(P),1);g/=m;let k=r[r.length-2],_=r[r.length-1];const C={x:0,y:0};for(let D=0;D<m;D++){const I=Zs(x,g),{x:v,y:M}=Kt(I[0],i,o,u,h,b,y,C),{x:w,y:R}=Kt(I[1],i,o,u,h,b,y,C),{x:F,y:Z}=Kt(I[2],i,o,u,h,b,y,C);an(r,k,_,v,M,w,R,F,Z),k=F,_=Z,x+=g}}function Xs(r,t,e){const n=(o,a)=>{const c=a.x-o.x,l=a.y-o.y,h=Math.sqrt(c*c+l*l),u=c/h,f=l/h;return{len:h,nx:u,ny:f}},s=(o,a)=>{o===0?r.moveTo(a.x,a.y):r.lineTo(a.x,a.y)};let i=t[t.length-1];for(let o=0;o<t.length;o++){const a=t[o%t.length],c=a.radius??e;if(c<=0){s(o,a),i=a;continue}const l=t[(o+1)%t.length],h=n(a,i),u=n(a,l);if(h.len<1e-4||u.len<1e-4){s(o,a),i=a;continue}let f=Math.asin(h.nx*u.ny-h.ny*u.nx),d=1,p=!1;h.nx*u.nx-h.ny*-u.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,d=-1,p=!0):f>0&&(d=-1,p=!0);const x=f/2;let g,b=Math.abs(Math.cos(x)*c/Math.sin(x));b>Math.min(h.len/2,u.len/2)?(b=Math.min(h.len/2,u.len/2),g=Math.abs(b*Math.sin(x)/Math.cos(x))):g=c;const y=a.x+u.nx*b+-u.ny*g*d,P=a.y+u.ny*b+u.nx*g*d,m=Math.atan2(h.ny,h.nx)+Math.PI/2*d,k=Math.atan2(u.ny,u.nx)-Math.PI/2*d;o===0&&r.moveTo(y+Math.cos(m)*g,P+Math.sin(m)*g),r.arc(y,P,g,m,k,p),i=a}}function Qs(r,t,e,n){const s=(a,c)=>Math.sqrt((a.x-c.x)**2+(a.y-c.y)**2),i=(a,c,l)=>({x:a.x+(c.x-a.x)*l,y:a.y+(c.y-a.y)*l}),o=t.length;for(let a=0;a<o;a++){const c=t[(a+1)%o],l=c.radius??e;if(l<=0){a===0?r.moveTo(c.x,c.y):r.lineTo(c.x,c.y);continue}const h=t[a],u=t[(a+2)%o],f=s(h,c);let d;if(f<1e-4)d=c;else{const g=Math.min(f/2,l);d=i(c,h,g/f)}const p=s(u,c);let x;if(p<1e-4)x=c;else{const g=Math.min(p/2,l);x=i(c,u,g/p)}a===0?r.moveTo(d.x,d.y):r.lineTo(d.x,d.y),r.quadraticCurveTo(c.x,c.y,x.x,x.y,n)}}const Ks=new dt;class Js{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new Oe,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const n=this._currentPoly.points,s=n[n.length-2],i=n[n.length-1];return(s!==t||i!==e)&&n.push(t,e),this}arc(t,e,n,s,i,o){this._ensurePoly(!1);const a=this._currentPoly.points;return cn(a,t,e,n,s,i,o),this}arcTo(t,e,n,s,i){this._ensurePoly();const o=this._currentPoly.points;return $s(o,t,e,n,s,i),this}arcToSvg(t,e,n,s,i,o,a){const c=this._currentPoly.points;return Ys(c,this._currentPoly.lastX,this._currentPoly.lastY,o,a,t,e,n,s,i),this}bezierCurveTo(t,e,n,s,i,o,a){this._ensurePoly();const c=this._currentPoly;return an(this._currentPoly.points,c.lastX,c.lastY,t,e,n,s,i,o,a),this}quadraticCurveTo(t,e,n,s,i){this._ensurePoly();const o=this._currentPoly;return js(this._currentPoly.points,o.lastX,o.lastY,t,e,n,s,i),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const n=this.shapePrimitives,s=n.length;for(let i=0;i<t.instructions.length;i++){const o=t.instructions[i];this[o.action](...o.data)}if(t.checkForHoles&&n.length-s>1){let i=null;for(let o=s;o<n.length;o++){const a=n[o];if(a.shape.type==="polygon"){const c=a.shape,l=i?.shape;l&&l.containsPolygon(c)?(i.holes||(i.holes=[]),i.holes.push(a),n.copyWithin(o,o+1),n.length--,o--):i=a}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,n,s,i){return this.drawShape(new dt(t,e,n,s),i),this}circle(t,e,n,s){return this.drawShape(new ae(t,e,n),s),this}poly(t,e,n){const s=new It(t);return s.closePath=e,this.drawShape(s,n),this}regularPoly(t,e,n,s,i=0,o){s=Math.max(s|0,3);const a=-1*Math.PI/2+i,c=Math.PI*2/s,l=[];for(let h=0;h<s;h++){const u=a-h*c;l.push(t+n*Math.cos(u),e+n*Math.sin(u))}return this.poly(l,!0,o),this}roundPoly(t,e,n,s,i,o=0,a){if(s=Math.max(s|0,3),i<=0)return this.regularPoly(t,e,n,s,o);const c=n*Math.sin(Math.PI/s)-.001;i=Math.min(i,c);const l=-1*Math.PI/2+o,h=Math.PI*2/s,u=(s-2)*Math.PI/s/2;for(let f=0;f<s;f++){const d=f*h+l,p=t+n*Math.cos(d),x=e+n*Math.sin(d),g=d+Math.PI+u,b=d-Math.PI-u,y=p+i*Math.cos(g),P=x+i*Math.sin(g),m=p+i*Math.cos(b),k=x+i*Math.sin(b);f===0?this.moveTo(y,P):this.lineTo(y,P),this.quadraticCurveTo(p,x,m,k,a)}return this.closePath()}roundShape(t,e,n=!1,s){return t.length<3?this:(n?Qs(this,t,e,s):Xs(this,t,e),this.closePath())}filletRect(t,e,n,s,i){if(i===0)return this.rect(t,e,n,s);const o=Math.min(n,s)/2,a=Math.min(o,Math.max(-o,i)),c=t+n,l=e+s,h=a<0?-a:0,u=Math.abs(a);return this.moveTo(t,e+u).arcTo(t+h,e+h,t+u,e,u).lineTo(c-u,e).arcTo(c-h,e+h,c,e+u,u).lineTo(c,l-u).arcTo(c-h,l-h,t+n-u,l,u).lineTo(t+u,l).arcTo(t+h,l-h,t,l-u,u).closePath()}chamferRect(t,e,n,s,i,o){if(i<=0)return this.rect(t,e,n,s);const a=Math.min(i,Math.min(n,s)/2),c=t+n,l=e+s,h=[t+a,e,c-a,e,c,e+a,c,l-a,c-a,l,t+a,l,t,l-a,t,e+a];for(let u=h.length-1;u>=2;u-=2)h[u]===h[u-2]&&h[u-1]===h[u-3]&&h.splice(u-1,2);return this.poly(h,!0,o)}ellipse(t,e,n,s,i){return this.drawShape(new ce(t,e,n,s),i),this}roundRect(t,e,n,s,i,o){return this.drawShape(new he(t,e,n,s,i),o),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let n=this._currentPoly;return n&&this.endPoly(),n=new It,n.points.push(t,e),this._currentPoly=n,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new It,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let n=e.shape.x,s=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const i=e.transform,o=n;n=i.a*n+i.c*s+i.tx,s=i.b*o+i.d*s+i.ty}this._currentPoly.points.push(n,s)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const n=t.instructions[e];this[n.action](...n.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let n=0;n<e.length;n++){const s=e[n],i=s.shape.getBounds(Ks);s.transform?t.addRect(i,s.transform):t.addRect(i)}return t}}class at{constructor(t,e=!1){this.instructions=[],this.uid=Nt("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?fs(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new Js(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,n,s,i){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(mt.shared);let c=0,l=0;if(!o||o.action!=="bezierCurveTo")c=a.x,l=a.y;else{c=o.data[2],l=o.data[3];const h=a.x,u=a.y;c=h+(h-c),l=u+(u-l)}return this.instructions.push({action:"bezierCurveTo",data:[c,l,t,e,n,s,i]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,n){const s=this.instructions[this.instructions.length-1],i=this.getLastPoint(mt.shared);let o=0,a=0;if(!s||s.action!=="quadraticCurveTo")o=i.x,a=i.y;else{o=s.data[0],a=s.data[1];const c=i.x,l=i.y;o=c+(c-o),a=l+(l-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,t,e,n]}),this._dirty=!0,this}rect(t,e,n,s,i){return this.instructions.push({action:"rect",data:[t,e,n,s,i]}),this._dirty=!0,this}circle(t,e,n,s){return this.instructions.push({action:"circle",data:[t,e,n,s]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,n,s,i,o,a){i||(i=s/2);const c=-1*Math.PI/2+o,l=n*2,h=Math.PI*2/l,u=[];for(let f=0;f<l;f++){const d=f%2?i:s,p=f*h+c;u.push(t+d*Math.cos(p),e+d*Math.sin(p))}return this.poly(u,!0,a),this}clone(t=!1){const e=new at;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let n=0;n<this.instructions.length;n++){const s=this.instructions[n];e.instructions.push({action:s.action,data:s.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,n=t.b,s=t.c,i=t.d,o=t.tx,a=t.ty;let c=0,l=0,h=0,u=0,f=0,d=0,p=0,x=0;for(let g=0;g<this.instructions.length;g++){const b=this.instructions[g],y=b.data;switch(b.action){case"moveTo":case"lineTo":c=y[0],l=y[1],y[0]=e*c+s*l+o,y[1]=n*c+i*l+a;break;case"bezierCurveTo":h=y[0],u=y[1],f=y[2],d=y[3],c=y[4],l=y[5],y[0]=e*h+s*u+o,y[1]=n*h+i*u+a,y[2]=e*f+s*d+o,y[3]=n*f+i*d+a,y[4]=e*c+s*l+o,y[5]=n*c+i*l+a;break;case"quadraticCurveTo":h=y[0],u=y[1],c=y[2],l=y[3],y[0]=e*h+s*u+o,y[1]=n*h+i*u+a,y[2]=e*c+s*l+o,y[3]=n*c+i*l+a;break;case"arcToSvg":c=y[5],l=y[6],p=y[0],x=y[1],y[0]=e*p+s*x,y[1]=n*p+i*x,y[5]=e*c+s*l+o,y[6]=n*c+i*l+a;break;case"circle":y[4]=St(y[3],t);break;case"rect":y[4]=St(y[4],t);break;case"ellipse":y[8]=St(y[8],t);break;case"roundRect":y[5]=St(y[5],t);break;case"addPath":y[0].transform(t);break;case"poly":y[2]=St(y[2],t);break;default:Ft("unknown transform action",b.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,n=this.instructions[e];if(!n)return t.x=0,t.y=0,t;for(;n.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;n=this.instructions[e]}switch(n.action){case"moveTo":case"lineTo":t.x=n.data[0],t.y=n.data[1];break;case"quadraticCurveTo":t.x=n.data[2],t.y=n.data[3];break;case"bezierCurveTo":t.x=n.data[4],t.y=n.data[5];break;case"arc":case"arcToSvg":t.x=n.data[5],t.y=n.data[6];break;case"addPath":n.data[0].getLastPoint(t);break}return t}}function St(r,t){return r?r.prepend(t):t.clone()}function W(r,t,e){const n=r.getAttribute(t);return n?Number(n):e}function tr(r,t){const e=r.querySelectorAll("defs");for(let n=0;n<e.length;n++){const s=e[n];for(let i=0;i<s.children.length;i++){const o=s.children[i];switch(o.nodeName.toLowerCase()){case"lineargradient":t.defs[o.id]=er(o);break;case"radialgradient":t.defs[o.id]=nr();break}}}}function er(r){const t=W(r,"x1",0),e=W(r,"y1",0),n=W(r,"x2",1),s=W(r,"y2",0),i=r.getAttribute("gradientUnits")||"objectBoundingBox",o=new bt(t,e,n,s,i==="objectBoundingBox"?"local":"global");for(let a=0;a<r.children.length;a++){const c=r.children[a],l=W(c,"offset",0),h=$.shared.setValue(c.getAttribute("stop-color")).toNumber();o.addColorStop(l,h)}return o}function nr(r){return Ft("[SVG Parser] Radial gradients are not yet supported"),new bt(0,0,1,0)}function Fe(r){const t=r.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const He={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function hn(r,t){const e=r.getAttribute("style"),n={},s={},i={strokeStyle:n,fillStyle:s,useFill:!1,useStroke:!1};for(const o in He){const a=r.getAttribute(o);a&&Le(t,i,o,a.trim())}if(e){const o=e.split(";");for(let a=0;a<o.length;a++){const c=o[a].trim(),[l,h]=c.split(":");He[l]&&Le(t,i,l,h.trim())}}return{strokeStyle:i.useStroke?n:null,fillStyle:i.useFill?s:null,useFill:i.useFill,useStroke:i.useStroke}}function Le(r,t,e,n){switch(e){case"stroke":if(n!=="none"){if(n.startsWith("url(")){const s=Fe(n);t.strokeStyle.fill=r.defs[s]}else t.strokeStyle.color=$.shared.setValue(n).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(n);break;case"fill":if(n!=="none"){if(n.startsWith("url(")){const s=Fe(n);t.fillStyle.fill=r.defs[s]}else t.fillStyle.color=$.shared.setValue(n).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(n);break;case"stroke-opacity":t.strokeStyle.alpha=Number(n);break;case"opacity":t.fillStyle.alpha=Number(n),t.strokeStyle.alpha=Number(n);break}}function sr(r){if(r.length<=2)return!0;const t=r.map(a=>a.area).sort((a,c)=>c-a),[e,n]=t,s=t[t.length-1],i=e/n,o=n/s;return!(i>3&&o<2)}function rr(r){return r.split(/(?=[Mm])/).filter(n=>n.trim().length>0)}function ir(r){const t=r.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),n=[],s=[];for(let h=0;h<e.length;h+=2)h+1<e.length&&(n.push(e[h]),s.push(e[h+1]));if(n.length===0||s.length===0)return 0;const i=Math.min(...n),o=Math.max(...n),a=Math.min(...s),c=Math.max(...s);return(o-i)*(c-a)}function We(r,t){const e=new at(r,!1);for(const n of e.instructions)t.instructions.push(n)}function or(r,t){if(typeof r=="string"){const o=document.createElement("div");o.innerHTML=r.trim(),r=o.querySelector("svg")}const e={context:t,defs:{},path:new at};tr(r,e);const n=r.children,{fillStyle:s,strokeStyle:i}=hn(r,e);for(let o=0;o<n.length;o++){const a=n[o];a.nodeName.toLowerCase()!=="defs"&&ln(a,e,s,i)}return t}function ln(r,t,e,n){const s=r.children,{fillStyle:i,strokeStyle:o}=hn(r,t);i&&e?e={...e,...i}:i&&(e=i),o&&n?n={...n,...o}:o&&(n=o);const a=!e&&!n;a&&(e={color:0});let c,l,h,u,f,d,p,x,g,b,y,P,m,k,_,C,D;switch(r.nodeName.toLowerCase()){case"path":{k=r.getAttribute("d");const I=r.getAttribute("fill-rule"),v=rr(k),M=I==="evenodd",w=v.length>1;if(M&&w){const F=v.map(S=>({path:S,area:ir(S)}));if(F.sort((S,T)=>T.area-S.area),v.length>3||!sr(F))for(let S=0;S<F.length;S++){const T=F[S],q=S===0;t.context.beginPath();const G=new at(void 0,!0);We(T.path,G),t.context.path(G),q?(e&&t.context.fill(e),n&&t.context.stroke(n)):t.context.cut()}else for(let S=0;S<F.length;S++){const T=F[S],q=S%2===1;t.context.beginPath();const G=new at(void 0,!0);We(T.path,G),t.context.path(G),q?t.context.cut():(e&&t.context.fill(e),n&&t.context.stroke(n))}}else{const F=I?I==="evenodd":!0;_=new at(k,F),t.context.path(_),e&&t.context.fill(e),n&&t.context.stroke(n)}break}case"circle":p=W(r,"cx",0),x=W(r,"cy",0),g=W(r,"r",0),t.context.ellipse(p,x,g,g),e&&t.context.fill(e),n&&t.context.stroke(n);break;case"rect":c=W(r,"x",0),l=W(r,"y",0),C=W(r,"width",0),D=W(r,"height",0),b=W(r,"rx",0),y=W(r,"ry",0),b||y?t.context.roundRect(c,l,C,D,b||y):t.context.rect(c,l,C,D),e&&t.context.fill(e),n&&t.context.stroke(n);break;case"ellipse":p=W(r,"cx",0),x=W(r,"cy",0),b=W(r,"rx",0),y=W(r,"ry",0),t.context.beginPath(),t.context.ellipse(p,x,b,y),e&&t.context.fill(e),n&&t.context.stroke(n);break;case"line":h=W(r,"x1",0),u=W(r,"y1",0),f=W(r,"x2",0),d=W(r,"y2",0),t.context.beginPath(),t.context.moveTo(h,u),t.context.lineTo(f,d),n&&t.context.stroke(n);break;case"polygon":m=r.getAttribute("points"),P=m.match(/-?\d+/g).map(I=>parseInt(I,10)),t.context.poly(P,!0),e&&t.context.fill(e),n&&t.context.stroke(n);break;case"polyline":m=r.getAttribute("points"),P=m.match(/-?\d+/g).map(I=>parseInt(I,10)),t.context.poly(P,!1),n&&t.context.stroke(n);break;case"g":case"svg":break;default:{Ft(`[SVG parser] <${r.nodeName}> elements unsupported`);break}}a&&(e=null);for(let I=0;I<s.length;I++)ln(s[I],t,e,n)}const ze={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class un{constructor(t,e){this.uid=Nt("fillPattern"),this._tick=0,this.transform=new U,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=ze[e].addressModeU,t.source.style.addressModeV=ze[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}function ar(r){return $.isColorLike(r)}function qe(r){return r instanceof un}function Ee(r){return r instanceof bt}function cr(r){return r instanceof ct}function hr(r,t,e){const n=$.shared.setValue(t??0);return r.color=n.toNumber(),r.alpha=n.alpha===1?e.alpha:n.alpha,r.texture=ct.WHITE,{...e,...r}}function lr(r,t,e){return r.texture=t,{...e,...r}}function Ue(r,t,e){return r.fill=t,r.color=16777215,r.texture=t.texture,r.matrix=t.transform,{...e,...r}}function Ve(r,t,e){return t.buildGradient(),r.fill=t,r.color=16777215,r.texture=t.texture,r.matrix=t.transform,r.textureSpace=t.textureSpace,{...e,...r}}function ur(r,t){const e={...t,...r},n=$.shared.setValue(e.color);return e.alpha*=n.alpha,e.color=n.toNumber(),e}function kt(r,t){if(r==null)return null;const e={},n=r;return ar(r)?hr(e,r,t):cr(r)?lr(e,r,t):qe(r)?Ue(e,r,t):Ee(r)?Ve(e,r,t):n.fill&&qe(n.fill)?Ue(n,n.fill,t):n.fill&&Ee(n.fill)?Ve(n,n.fill,t):ur(n,t)}function je(r,t){const{width:e,alignment:n,miterLimit:s,cap:i,join:o,pixelLine:a,...c}=t,l=kt(r,c);return l?{width:e,alignment:n,miterLimit:s,cap:i,join:o,pixelLine:a,...l}:null}const dr=new mt,Ne=new U,pe=class et extends Dn{constructor(){super(...arguments),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=Nt("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this.destroyed=!1,this._activePath=new at,this._transform=new U,this._fillStyle={...et.defaultFillStyle},this._strokeStyle={...et.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new Oe,this._boundsDirty=!0}clone(){const t=new et;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=kt(t,et.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=je(t,et.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=kt(t,et.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=kt(t,et.defaultStrokeStyle),this}texture(t,e,n,s,i,o){return this.instructions.push({action:"texture",data:{image:t,dx:n||0,dy:s||0,dw:i||t.frame.width,dh:o||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e||e===0?$.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new at,this}fill(t,e){let n;const s=this.instructions[this.instructions.length-1];return this._tick===0&&s?.action==="stroke"?n=s.data.path:n=this._activePath.clone(),n?(t!=null&&(e!==void 0&&typeof t=="number"&&(N(tt,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=kt(t,et.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:n}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(mt.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n?.action==="fill"?e=n.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=je(t,et.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],n=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(n);else{e.data.hole=n;break}}return this._initNextPathLocation(),this}arc(t,e,n,s,i,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,n,s,i,o),this}arcTo(t,e,n,s,i){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*n+o.c*s+o.tx,o.b*n+o.d*s+o.ty,i),this}arcToSvg(t,e,n,s,i,o,a){this._tick++;const c=this._transform;return this._activePath.arcToSvg(t,e,n,s,i,c.a*o+c.c*a+c.tx,c.b*o+c.d*a+c.ty),this}bezierCurveTo(t,e,n,s,i,o,a){this._tick++;const c=this._transform;return this._activePath.bezierCurveTo(c.a*t+c.c*e+c.tx,c.b*t+c.d*e+c.ty,c.a*n+c.c*s+c.tx,c.b*n+c.d*s+c.ty,c.a*i+c.c*o+c.tx,c.b*i+c.d*o+c.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,n,s){return this._tick++,this._activePath.ellipse(t,e,n,s,this._transform.clone()),this}circle(t,e,n){return this._tick++,this._activePath.circle(t,e,n,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const n=this._transform;return this._activePath.lineTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty),this}moveTo(t,e){this._tick++;const n=this._transform,s=this._activePath.instructions,i=n.a*t+n.c*e+n.tx,o=n.b*t+n.d*e+n.ty;return s.length===1&&s[0].action==="moveTo"?(s[0].data[0]=i,s[0].data[1]=o,this):(this._activePath.moveTo(i,o),this)}quadraticCurveTo(t,e,n,s,i){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*n+o.c*s+o.tx,o.b*n+o.d*s+o.ty,i),this}rect(t,e,n,s){return this._tick++,this._activePath.rect(t,e,n,s,this._transform.clone()),this}roundRect(t,e,n,s,i){return this._tick++,this._activePath.roundRect(t,e,n,s,i,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,n,s,i=0,o){return this._tick++,this._activePath.regularPoly(t,e,n,s,i,o),this}roundPoly(t,e,n,s,i,o){return this._tick++,this._activePath.roundPoly(t,e,n,s,i,o),this}roundShape(t,e,n,s){return this._tick++,this._activePath.roundShape(t,e,n,s),this}filletRect(t,e,n,s,i){return this._tick++,this._activePath.filletRect(t,e,n,s,i),this}chamferRect(t,e,n,s,i,o){return this._tick++,this._activePath.chamferRect(t,e,n,s,i,o),this}star(t,e,n,s,i=0,o=0){return this._tick++,this._activePath.star(t,e,n,s,i,o,this._transform.clone()),this}svg(t){return this._tick++,or(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,n,s,i,o){return t instanceof U?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,n,s,i,o),this)}transform(t,e,n,s,i,o){return t instanceof U?(this._transform.append(t),this):(Ne.set(t,e,n,s,i,o),this._transform.append(Ne),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const n=this.instructions[e],s=n.action;if(s==="fill"){const i=n.data;t.addBounds(i.path.bounds)}else if(s==="texture"){const i=n.data;t.addFrame(i.dx,i.dy,i.dx+i.dw,i.dy+i.dh,i.transform)}if(s==="stroke"){const i=n.data,o=i.style.alignment,a=i.style.width*(1-o),c=i.path.bounds;t.addFrame(c.minX-a,c.minY-a,c.maxX+a,c.maxY+a)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let n=!1;for(let s=0;s<e.length;s++){const i=e[s],o=i.data,a=o.path;if(!i.action||!a)continue;const c=o.style,l=a.shapePath.shapePrimitives;for(let h=0;h<l.length;h++){const u=l[h].shape;if(!c||!u)continue;const f=l[h].transform,d=f?f.applyInverse(t,dr):t;if(i.action==="fill")n=u.contains(d.x,d.y);else{const x=c;n=u.strokeContains(d.x,d.y,x.width,x.alignment)}const p=o.hole;if(p){const x=p.shapePath?.shapePrimitives;if(x)for(let g=0;g<x.length;g++)x[g].shape.contains(d.x,d.y)&&(n=!1)}if(n)return!0}}return n}unload(){this.emit("unload",this);for(const t in this._gpuData)this._gpuData[t]?.destroy();this._gpuData=Object.create(null)}destroy(t=!1){if(this.destroyed)return;if(this.destroyed=!0,this._stateStack.length=0,this._transform=null,this.unload(),this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const n=typeof t=="boolean"?t:t?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(n)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(n))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};pe.defaultFillStyle={color:16777215,alpha:1,texture:ct.WHITE,matrix:null,fill:null,textureSpace:"local"};pe.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:ct.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let vt=pe;class fr{constructor(){this.isBatchable=!1}reset(){this.isBatchable=!1,this.context=null,this.graphicsData&&(this.graphicsData.destroy(),this.graphicsData=null)}destroy(){this.reset()}}class pr{constructor(){this.instructions=new Ze}init(){this.instructions.reset()}destroy(){this.instructions.destroy(),this.instructions=null}}const xe=class oe{constructor(t){this._renderer=t,this._managedContexts=new $t({renderer:t,type:"resource",name:"graphicsContext"})}init(t){oe.defaultOptions.bezierSmoothness=t?.bezierSmoothness??oe.defaultOptions.bezierSmoothness}getContextRenderData(t){return this.getGpuContext(t).graphicsData||this._initContextRenderData(t)}updateGpuContext(t){const e=t._gpuData,n=!!e[this._renderer.uid],s=e[this._renderer.uid]||this._initContext(t);return(t.dirty||!n)&&(n&&s.reset(),s.isBatchable=!1,t.dirty=!1),s}getGpuContext(t){return t._gpuData[this._renderer.uid]||this._initContext(t)}_initContextRenderData(t){const e=new pr,n=this.getGpuContext(t);return n.graphicsData=e,e.init(),e}_initContext(t){const e=new fr;return e.context=t,t._gpuData[this._renderer.uid]=e,this._managedContexts.add(t),e}destroy(){this._managedContexts.destroy(),this._renderer=null}};xe.extension={type:[z.CanvasSystem],name:"graphicsContext"};xe.defaultOptions={bezierSmoothness:.5};let xr=xe;class dn{constructor(t,e){this.state=Xe.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this),this._managedGraphics=new $t({renderer:t,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){return!1}addRenderable(t,e){this._managedGraphics.add(t),this.renderer.renderPipes.batch.break(e),e.add(t)}updateRenderable(t){}execute(t){t.isRenderable&&this._adaptor.execute(this,t)}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null}}dn.extension={type:[z.CanvasPipes],name:"graphics"};class gr{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{xt.return(t)}),this.batches.length=0}}class fn{constructor(t,e){this.state=Xe.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this),this._managedGraphics=new $t({renderer:t,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){const e=t.context,n=!!t._gpuData,i=this.renderer.graphicsContext.updateGpuContext(e);return!!(i.isBatchable||n!==i.isBatchable)}addRenderable(t,e){const s=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),s.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const n=this._getGpuDataForRenderable(t).batches;for(let s=0;s<n.length;s++){const i=n[s];i._batcher.updateElement(i)}}execute(t){if(!t.isRenderable)return;const e=this.renderer,n=t.context;if(!e.graphicsContext.getGpuContext(n).batches.length)return;const i=n.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const o=i.resources.localUniforms.uniforms;o.uTransformMatrix=t.groupTransform,o.uRound=e._roundPixels|t._roundPixels,Hn(t.groupColorAlpha,o.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=this._getGpuDataForRenderable(t),s=this.renderer.graphicsContext.updateGpuContext(t.context);e.destroy(),s.isBatchable&&this._updateBatchesForRenderable(t,e)}_addToBatcher(t,e){const n=this.renderer.renderPipes.batch,s=this._getGpuDataForRenderable(t).batches;for(let i=0;i<s.length;i++){const o=s[i];n.addToBatch(o,e)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){const e=new gr;return t._gpuData[this.renderer.uid]=e,this._managedGraphics.add(t),e}_updateBatchesForRenderable(t,e){const n=t.context,i=this.renderer.graphicsContext.getGpuContext(n),o=this.renderer._roundPixels|t._roundPixels;e.batches=i.batches.map(a=>{const c=xt.get(le);return a.copyTo(c),c.renderable=t,c.roundPixels=o,c})}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}fn.extension={type:[z.WebGLPipes,z.WebGPUPipes],name:"graphics"};rt.add(dn);rt.add(fn);rt.add(xr);rt.add(fe);class jt extends Gn{constructor(t){t instanceof vt&&(t={context:t});const{context:e,roundPixels:n,...s}=t||{};super({label:"Graphics",...s}),this.renderPipeId="graphics",e?this.context=e:(this.context=this._ownedContext=new vt,this.context.autoGarbageCollect=this.autoGarbageCollect),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=n??!1}set context(t){t!==this._context&&(this._context&&(this._context.off("update",this.onViewUpdate,this),this._context.off("unload",this.unload,this)),this._context=t,this._context.on("update",this.onViewUpdate,this),this._context.on("unload",this.unload,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_onTouch(t){this._gcLastUsed=t,this._context._gcLastUsed=t}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new jt(this._context.clone()):(this._ownedContext=null,new jt(this._context))}lineStyle(t,e,n){N(tt,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const s={};return t&&(s.width=t),e&&(s.color=e),n&&(s.alpha=n),this.context.strokeStyle=s,this}beginFill(t,e){N(tt,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const n={};return t!==void 0&&(n.color=t),e!==void 0&&(n.alpha=e),this.context.fillStyle=n,this}endFill(){N(tt,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==vt.defaultStrokeStyle.width||t.color!==vt.defaultStrokeStyle.color||t.alpha!==vt.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return N(tt,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return N(tt,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return N(tt,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return N(tt,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return N(tt,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return N(tt,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}let yt;function $e(r){const t=st.get().createCanvas(6,1),e=t.getContext("2d");return e.fillStyle=r,e.fillRect(0,0,6,1),t}function pn(){if(yt!==void 0)return yt;try{const r=$e("#ff00ff"),t=$e("#ffff00"),n=st.get().createCanvas(6,1).getContext("2d");n.globalCompositeOperation="multiply",n.drawImage(r,0,0),n.drawImage(t,2,0);const s=n.getImageData(2,0,1,1);if(!s)yt=!1;else{const i=s.data;yt=i[0]===255&&i[1]===0&&i[2]===0}}catch{yt=!1}return yt}const B={canvas:null,convertTintToImage:!1,cacheStepsPerColorChannel:8,canUseMultiply:pn(),tintMethod:null,_canvasSourceCache:new WeakMap,_unpremultipliedCache:new WeakMap,getCanvasSource:r=>{const t=r.source,e=t?.resource;if(!e)return null;const n=t.alphaMode==="premultiplied-alpha",s=t.resourceWidth??t.pixelWidth,i=t.resourceHeight??t.pixelHeight,o=s!==t.pixelWidth||i!==t.pixelHeight;if(n){if((e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)&&!o)return e;const a=B._unpremultipliedCache.get(t);if(a?.resourceId===t._resourceId)return a.canvas}if(e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof ArrayBuffer){const a=B._canvasSourceCache.get(t);if(a?.resourceId===t._resourceId)return a.canvas;const c=st.get().createCanvas(t.pixelWidth,t.pixelHeight),l=c.getContext("2d"),h=l.createImageData(t.pixelWidth,t.pixelHeight),u=h.data,f=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(t.format==="bgra8unorm")for(let d=0;d<u.length&&d+3<f.length;d+=4)u[d]=f[d+2],u[d+1]=f[d+1],u[d+2]=f[d],u[d+3]=f[d+3];else u.set(f.subarray(0,u.length));return l.putImageData(h,0,0),B._canvasSourceCache.set(t,{canvas:c,resourceId:t._resourceId}),c}if(n){const a=st.get().createCanvas(t.pixelWidth,t.pixelHeight),c=a.getContext("2d",{willReadFrequently:!0});a.width=t.pixelWidth,a.height=t.pixelHeight,c.drawImage(e,0,0);const l=c.getImageData(0,0,a.width,a.height),h=l.data;for(let u=0;u<h.length;u+=4){const f=h[u+3];if(f>0){const d=255/f;h[u]=Math.min(255,h[u]*d+.5),h[u+1]=Math.min(255,h[u+1]*d+.5),h[u+2]=Math.min(255,h[u+2]*d+.5)}}return c.putImageData(l,0,0),B._unpremultipliedCache.set(t,{canvas:a,resourceId:t._resourceId}),a}if(o){const a=B._canvasSourceCache.get(t);if(a?.resourceId===t._resourceId)return a.canvas;const c=st.get().createCanvas(t.pixelWidth,t.pixelHeight),l=c.getContext("2d");return c.width=t.pixelWidth,c.height=t.pixelHeight,l.drawImage(e,0,0),B._canvasSourceCache.set(t,{canvas:c,resourceId:t._resourceId}),c}return e},getTintedCanvas:(r,t)=>{const e=r.texture,n=$.shared.setValue(t).toHex(),s=e.tintCache||(e.tintCache={}),i=s[n],o=e.source._resourceId;if(i?.tintId===o)return i;const a=i&&"getContext"in i?i:st.get().createCanvas();return B.tintMethod(e,t,a),a.tintId=o,s[n]=a,s[n]},getTintedPattern:(r,t)=>{const e=$.shared.setValue(t).toHex(),n=r.patternCache||(r.patternCache={}),s=r.source._resourceId;let i=n[e];return i?.tintId===s||(B.canvas||(B.canvas=st.get().createCanvas()),B.tintMethod(r,t,B.canvas),i=B.canvas.getContext("2d").createPattern(B.canvas,"repeat"),i.tintId=s,n[e]=i),i},applyPatternTransform:(r,t,e=!0)=>{if(!t)return;const n=r;if(!n.setTransform)return;const s=globalThis.DOMMatrix;if(!s)return;const i=new s([t.a,t.b,t.c,t.d,t.tx,t.ty]);n.setTransform(e?i.inverse():i)},tintWithMultiply:(r,t,e)=>{const n=e.getContext("2d"),s=r.frame.clone(),i=r.source._resolution??r.source.resolution??1,o=r.rotate;s.x*=i,s.y*=i,s.width*=i,s.height*=i;const a=nt.isVertical(o),c=a?s.height:s.width,l=a?s.width:s.height;e.width=Math.ceil(c),e.height=Math.ceil(l),n.save(),n.fillStyle=$.shared.setValue(t).toHex(),n.fillRect(0,0,c,l),n.globalCompositeOperation="multiply";const h=B.getCanvasSource(r);if(!h){n.restore();return}o&&B._applyInverseRotation(n,o,s.width,s.height),n.drawImage(h,s.x,s.y,s.width,s.height,0,0,s.width,s.height),n.globalCompositeOperation="destination-atop",n.drawImage(h,s.x,s.y,s.width,s.height,0,0,s.width,s.height),n.restore()},tintWithOverlay:(r,t,e)=>{const n=e.getContext("2d"),s=r.frame.clone(),i=r.source._resolution??r.source.resolution??1,o=r.rotate;s.x*=i,s.y*=i,s.width*=i,s.height*=i;const a=nt.isVertical(o),c=a?s.height:s.width,l=a?s.width:s.height;e.width=Math.ceil(c),e.height=Math.ceil(l),n.save(),n.globalCompositeOperation="copy",n.fillStyle=$.shared.setValue(t).toHex(),n.fillRect(0,0,c,l),n.globalCompositeOperation="destination-atop";const h=B.getCanvasSource(r);if(!h){n.restore();return}o&&B._applyInverseRotation(n,o,s.width,s.height),n.drawImage(h,s.x,s.y,s.width,s.height,0,0,s.width,s.height),n.restore()},tintWithPerPixel:(r,t,e)=>{const n=e.getContext("2d"),s=r.frame.clone(),i=r.source._resolution??r.source.resolution??1,o=r.rotate;s.x*=i,s.y*=i,s.width*=i,s.height*=i;const a=nt.isVertical(o),c=a?s.height:s.width,l=a?s.width:s.height;e.width=Math.ceil(c),e.height=Math.ceil(l),n.save(),n.globalCompositeOperation="copy";const h=B.getCanvasSource(r);if(!h){n.restore();return}o&&B._applyInverseRotation(n,o,s.width,s.height),n.drawImage(h,s.x,s.y,s.width,s.height,0,0,s.width,s.height),n.restore();const u=t>>16&255,f=t>>8&255,d=t&255,p=n.getImageData(0,0,c,l),x=p.data;for(let g=0;g<x.length;g+=4)x[g]=x[g]*u/255,x[g+1]=x[g+1]*f/255,x[g+2]=x[g+2]*d/255;n.putImageData(p,0,0)},_applyInverseRotation:(r,t,e,n)=>{const s=nt.inv(t),i=nt.uX(s),o=nt.uY(s),a=nt.vX(s),c=nt.vY(s),l=-Math.min(0,i*e,a*n,i*e+a*n),h=-Math.min(0,o*e,c*n,o*e+c*n);r.transform(i,o,a,c,l,h)}};B.tintMethod=B.canUseMultiply?B.tintWithMultiply:B.tintWithPerPixel;const ge=class pt{static _getPatternRepeat(t,e){const n=t&&t!=="clamp-to-edge",s=e&&e!=="clamp-to-edge";return n&&s?"repeat":n?"repeat-x":s?"repeat-y":"no-repeat"}start(t,e,n){}execute(t,e){const n=e.elements;if(!n||!n.length)return;const s=t.renderer,i=s.canvasContext,o=i.activeContext;for(let a=0;a<n.length;a++){const c=n[a];if(!c.packAsQuad)continue;const l=c,h=l.texture,u=h?B.getCanvasSource(h):null;if(!u)continue;const f=h.source.style,d=i.smoothProperty,p=f.scaleMode!=="nearest";o[d]!==p&&(o[d]=p),i.setBlendMode(e.blendMode);const x=s.globalUniforms.globalUniformData?.worldColor??4294967295,g=l.color,b=(x>>>24&255)/255,y=(g>>>24&255)/255,P=s.filter?.alphaMultiplier??1,m=b*y*P;if(m<=0)continue;o.globalAlpha=m;const k=x&16777215,_=g&16777215,C=Ye(wt(_,k)),D=h.frame,I=f.addressModeU??f.addressMode,v=f.addressModeV??f.addressMode,M=pt._getPatternRepeat(I,v),w=h.source._resolution??h.source.resolution??1,R=l.renderable?.renderGroup?.isCachedAsTexture,F=D.x*w,Z=D.y*w,S=D.width*w,T=D.height*w,q=l.bounds,G=s.renderTarget.renderTarget.isRoot,E=q.minX,X=q.minY,O=q.maxX-q.minX,V=q.maxY-q.minY,j=h.rotate,A=h.uvs,it=Math.min(A.x0,A.x1,A.x2,A.x3,A.y0,A.y1,A.y2,A.y3),Lt=Math.max(A.x0,A.x1,A.x2,A.x3,A.y0,A.y1,A.y2,A.y3),Ct=M!=="no-repeat"&&(it<0||Lt>1),ht=j&&!(!Ct&&(C!==16777215||j));ht?(pt._tempPatternMatrix.copyFrom(l.transform),nt.matrixAppendRotationInv(pt._tempPatternMatrix,j,E,X,O,V),i.setContextTransform(pt._tempPatternMatrix,l.roundPixels===1,void 0,R&&G)):i.setContextTransform(l.transform,l.roundPixels===1,void 0,R&&G);const lt=ht?0:E,Y=ht?0:X,Q=O,K=V;if(Ct){let J=u;const ut=C!==16777215&&!j,ot=D.width<=h.source.width&&D.height<=h.source.height;ut&&ot&&(J=B.getTintedCanvas({texture:h},C));const Mt=o.createPattern(J,M);if(!Mt)continue;const Zt=Q,ye=K;if(Zt===0||ye===0)continue;const me=1/Zt,_e=1/ye,be=(A.x1-A.x0)*me,Ce=(A.y1-A.y0)*me,Pe=(A.x3-A.x0)*_e,Me=(A.y3-A.y0)*_e,Tn=A.x0-be*lt-Pe*Y,kn=A.y0-Ce*lt-Me*Y,Ot=h.source.pixelWidth,Yt=h.source.pixelHeight;pt._tempPatternMatrix.set(be*Ot,Ce*Yt,Pe*Ot,Me*Yt,Tn*Ot,kn*Yt),B.applyPatternTransform(Mt,pt._tempPatternMatrix),o.fillStyle=Mt,o.fillRect(lt,Y,Q,K)}else{const ut=C!==16777215||j?B.getTintedCanvas({texture:h},C):u,ot=ut!==u;o.drawImage(ut,ot?0:F,ot?0:Z,ot?ut.width:S,ot?ut.height:T,lt,Y,Q,K)}}}};ge._tempPatternMatrix=new U;ge.extension={type:[z.CanvasPipesAdaptor],name:"batch"};let yr=ge;class xn{constructor(t){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=t}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(t,e,n){this._renderer.renderPipes.batch.break(n);const s=this._colorStack;s[this._colorStackIndex]=s[this._colorStackIndex-1]&t.mask;const i=this._colorStack[this._colorStackIndex];i!==this._currentColor&&(this._currentColor=i,n.add({renderPipeId:"colorMask",colorMask:i,canBundle:!1})),this._colorStackIndex++}pop(t,e,n){this._renderer.renderPipes.batch.break(n);const s=this._colorStack;this._colorStackIndex--;const i=s[this._colorStackIndex-1];i!==this._currentColor&&(this._currentColor=i,n.add({renderPipeId:"colorMask",colorMask:i,canBundle:!1}))}execute(t){}destroy(){this._renderer=null,this._colorStack=null}}xn.extension={type:[z.CanvasPipes],name:"colorMask"};function mr(r,t,e,n,s,i){i=Math.max(0,Math.min(i,Math.min(n,s)/2)),r.moveTo(t+i,e),r.lineTo(t+n-i,e),r.quadraticCurveTo(t+n,e,t+n,e+i),r.lineTo(t+n,e+s-i),r.quadraticCurveTo(t+n,e+s,t+n-i,e+s),r.lineTo(t+i,e+s),r.quadraticCurveTo(t,e+s,t,e+s-i),r.lineTo(t,e+i),r.quadraticCurveTo(t,e,t+i,e)}function gn(r,t){switch(t.type){case"rectangle":{const e=t;r.rect(e.x,e.y,e.width,e.height);break}case"roundedRectangle":{const e=t;mr(r,e.x,e.y,e.width,e.height,e.radius);break}case"circle":{const e=t;r.moveTo(e.x+e.radius,e.y),r.arc(e.x,e.y,e.radius,0,Math.PI*2);break}case"ellipse":{const e=t;r.ellipse?(r.moveTo(e.x+e.halfWidth,e.y),r.ellipse(e.x,e.y,e.halfWidth,e.halfHeight,0,0,Math.PI*2)):(r.save(),r.translate(e.x,e.y),r.scale(e.halfWidth,e.halfHeight),r.moveTo(1,0),r.arc(0,0,1,0,Math.PI*2),r.restore());break}case"triangle":{const e=t;r.moveTo(e.x,e.y),r.lineTo(e.x2,e.y2),r.lineTo(e.x3,e.y3),r.closePath();break}default:{const e=t,n=e.points;if(!n?.length)break;r.moveTo(n[0],n[1]);for(let s=2;s<n.length;s+=2)r.lineTo(n[s],n[s+1]);e.closePath&&r.closePath();break}}}function _r(r,t){if(!t?.length)return!1;for(let e=0;e<t.length;e++){const n=t[e];if(!n?.shape)continue;const s=n.transform,i=s&&!s.isIdentity();i&&(r.save(),r.transform(s.a,s.b,s.c,s.d,s.tx,s.ty)),gn(r,n.shape),i&&r.restore()}return!0}class yn{constructor(t){this._warnedMaskTypes=new Set,this._canvasMaskStack=[],this._renderer=t}push(t,e,n){this._renderer.renderPipes.batch.break(n),n.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:t,inverse:e._maskOptions.inverse,canBundle:!1})}pop(t,e,n){this._renderer.renderPipes.batch.break(n),n.add({renderPipeId:"stencilMask",action:"popMaskEnd",mask:t,inverse:e._maskOptions.inverse,canBundle:!1})}execute(t){if(t.action!=="pushMaskBegin"&&t.action!=="popMaskEnd")return;const e=this._renderer,n=e.canvasContext,s=n?.activeContext;if(!s)return;if(t.action==="popMaskEnd"){this._canvasMaskStack.pop()&&s.restore();return}t.inverse&&this._warnOnce("inverse","CanvasRenderer: inverse masks are not supported on Canvas2D; ignoring inverse flag.");const i=t.mask.mask;if(!(i instanceof jt)){this._warnOnce("nonGraphics","CanvasRenderer: only Graphics masks are supported in Canvas2D; skipping mask."),this._canvasMaskStack.push(!1);return}const o=i,a=o.context?.instructions;if(!a?.length){this._canvasMaskStack.push(!1);return}s.save(),n.setContextTransform(o.groupTransform,(e._roundPixels|o._roundPixels)===1),s.beginPath();let c=!1,l=!1;for(let h=0;h<a.length;h++){const u=a[h],f=u.action;if(f!=="fill"&&f!=="stroke")continue;const p=u.data?.path?.shapePath;if(!p?.shapePrimitives?.length)continue;const x=p.shapePrimitives;for(let g=0;g<x.length;g++){const b=x[g];if(!b?.shape)continue;const y=b.transform,P=y&&!y.isIdentity();P&&(s.save(),s.transform(y.a,y.b,y.c,y.d,y.tx,y.ty)),gn(s,b.shape),l=_r(s,b.holes)||l,c=!0,P&&s.restore()}}if(!c){s.restore(),this._canvasMaskStack.push(!1);return}l?s.clip("evenodd"):s.clip(),this._canvasMaskStack.push(!0)}destroy(){this._renderer=null,this._warnedMaskTypes=null,this._canvasMaskStack=null}_warnOnce(t,e){this._warnedMaskTypes.has(t)||(this._warnedMaskTypes.add(t),Ft(e))}}yn.extension={type:[z.CanvasPipes],name:"stencilMask"};const H="source-over";function br(){const r=pn(),t=Object.create(null);return t.inherit=H,t.none=H,t.normal="source-over",t.add="lighter",t.multiply=r?"multiply":H,t.screen=r?"screen":H,t.overlay=r?"overlay":H,t.darken=r?"darken":H,t.lighten=r?"lighten":H,t["color-dodge"]=r?"color-dodge":H,t["color-burn"]=r?"color-burn":H,t["hard-light"]=r?"hard-light":H,t["soft-light"]=r?"soft-light":H,t.difference=r?"difference":H,t.exclusion=r?"exclusion":H,t.saturation=r?"saturation":H,t.color=r?"color":H,t.luminosity=r?"luminosity":H,t["linear-burn"]=r?"color-burn":H,t["linear-dodge"]=r?"color-dodge":H,t["linear-light"]=r?"hard-light":H,t["pin-light"]=r?"hard-light":H,t["vivid-light"]=r?"hard-light":H,t["hard-mix"]=H,t.negation=r?"difference":H,t["normal-npm"]=t.normal,t["add-npm"]=t.add,t["screen-npm"]=t.screen,t.erase="destination-out",t.subtract=H,t.divide=H,t.min=H,t.max=H,t}const Cr=new U;class mn{constructor(t){this.activeResolution=1,this.smoothProperty="imageSmoothingEnabled",this.blendModes=br(),this._activeBlendMode="normal",this._projTransform=null,this._outerBlend=!1,this._warnedBlendModes=new Set,this._renderer=t}resolutionChange(t){this.activeResolution=t}init(){const t=this._renderer.background.alpha<1;if(this.rootContext=this._renderer.canvas.getContext("2d",{alpha:t}),this.activeContext=this.rootContext,this.activeResolution=this._renderer.resolution,!this.rootContext.imageSmoothingEnabled){const e=this.rootContext;e.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":e.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":e.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":e.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")}}setContextTransform(t,e,n,s){const i=s?U.IDENTITY:this._renderer.globalUniforms.globalUniformData?.worldTransformMatrix||U.IDENTITY;let o=Cr;o.copyFrom(i),o.append(t);const a=this._projTransform,c=this.activeResolution;if(n=n||c,a){const l=U.shared;l.copyFrom(o),l.prepend(a),o=l}e?this.activeContext.setTransform(o.a*n,o.b*n,o.c*n,o.d*n,o.tx*c|0,o.ty*c|0):this.activeContext.setTransform(o.a*n,o.b*n,o.c*n,o.d*n,o.tx*c,o.ty*c)}clear(t,e){const n=this.activeContext,s=this._renderer;if(n.clearRect(0,0,s.width,s.height),t){const i=$.shared.setValue(t);n.globalAlpha=e??i.alpha,n.fillStyle=i.toHex(),n.fillRect(0,0,s.width,s.height),n.globalAlpha=1}}setBlendMode(t){if(this._activeBlendMode===t)return;this._activeBlendMode=t,this._outerBlend=!1;const e=this.blendModes[t];if(!e){this._warnedBlendModes.has(t)||(console.warn(`CanvasRenderer: blend mode "${t}" is not supported in Canvas2D; falling back to "source-over".`),this._warnedBlendModes.add(t)),this.activeContext.globalCompositeOperation="source-over";return}this.activeContext.globalCompositeOperation=e}destroy(){this.rootContext=null,this.activeContext=null,this._warnedBlendModes.clear()}}mn.extension={type:[z.CanvasSystem],name:"canvasContext"};class _n{constructor(){this.maxTextures=16,this.maxBatchableTextures=16,this.maxUniformBindings=0}init(){}}_n.extension={type:[z.CanvasSystem],name:"limits"};const Pr="#808080",Ut=new U,Mr=new U,Sr=new U,Jt=new U;function vr(r,t,e){r.beginPath();for(let n=0;n<e.length;n+=3){const s=e[n]*2,i=e[n+1]*2,o=e[n+2]*2;r.moveTo(t[s],t[s+1]),r.lineTo(t[i],t[i+1]),r.lineTo(t[o],t[o+1]),r.closePath()}r.fill()}function Tr(r){return`#${(r&16777215).toString(16).padStart(6,"0")}`}function kr(r,t,e,n,s,i){i=Math.max(0,Math.min(i,Math.min(n,s)/2)),r.moveTo(t+i,e),r.lineTo(t+n-i,e),r.quadraticCurveTo(t+n,e,t+n,e+i),r.lineTo(t+n,e+s-i),r.quadraticCurveTo(t+n,e+s,t+n-i,e+s),r.lineTo(t+i,e+s),r.quadraticCurveTo(t,e+s,t,e+s-i),r.lineTo(t,e+i),r.quadraticCurveTo(t,e,t+i,e)}function Vt(r,t){switch(t.type){case"rectangle":{const e=t;r.rect(e.x,e.y,e.width,e.height);break}case"roundedRectangle":{const e=t;kr(r,e.x,e.y,e.width,e.height,e.radius);break}case"circle":{const e=t;r.arc(e.x,e.y,e.radius,0,Math.PI*2);break}case"ellipse":{const e=t;r.ellipse?r.ellipse(e.x,e.y,e.halfWidth,e.halfHeight,0,0,Math.PI*2):(r.save(),r.translate(e.x,e.y),r.scale(e.halfWidth,e.halfHeight),r.arc(0,0,1,0,Math.PI*2),r.restore());break}case"triangle":{const e=t;r.moveTo(e.x,e.y),r.lineTo(e.x2,e.y2),r.lineTo(e.x3,e.y3),r.closePath();break}default:{const e=t,n=e.points;if(!n?.length)break;r.moveTo(n[0],n[1]);for(let s=2;s<n.length;s+=2)r.lineTo(n[s],n[s+1]);e.closePath&&r.closePath();break}}}function wr(r,t){if(!t?.length)return!1;for(let e=0;e<t.length;e++){const n=t[e];if(!n?.shape)continue;const s=n.transform,i=s&&!s.isIdentity();i&&(r.save(),r.transform(s.a,s.b,s.c,s.d,s.tx,s.ty)),Vt(r,n.shape),i&&r.restore()}return!0}function Ir(r,t,e,n){const s=r.fill;if(s instanceof bt){s.buildGradient();const o=s.texture;if(o){const a=B.getTintedPattern(o,t),c=e?Jt.copyFrom(e).scale(o.source.pixelWidth,o.source.pixelHeight):Jt.copyFrom(s.transform);return n&&!r.textureSpace&&c.append(n),B.applyPatternTransform(a,c),a}}if(s instanceof un){const o=B.getTintedPattern(s.texture,t);return B.applyPatternTransform(o,s.transform),o}const i=r.texture;if(i&&i!==ct.WHITE){if(!i.source.resource)return Pr;const o=B.getTintedPattern(i,t),a=e?Jt.copyFrom(e).scale(i.source.pixelWidth,i.source.pixelHeight):r.matrix;return B.applyPatternTransform(o,a),o}return Tr(t)}class bn{constructor(){this.shader=null}contextChange(t){}execute(t,e){const n=t.renderer,s=n.canvasContext,i=s.activeContext,o=e.groupTransform,a=n.globalUniforms.globalUniformData?.worldColor??4294967295,c=e.groupColorAlpha,l=(a>>>24&255)/255,h=(c>>>24&255)/255,u=n.filter?.alphaMultiplier??1,f=l*h*u;if(f<=0)return;const d=a&16777215,p=c&16777215,x=Ye(wt(p,d)),g=n._roundPixels|e._roundPixels;i.save(),s.setContextTransform(o,g===1),s.setBlendMode(e.groupBlendMode);const b=e.context.instructions;for(let y=0;y<b.length;y++){const P=b[y];if(P.action==="texture"){const M=P.data,w=M.image,R=w?B.getCanvasSource(w):null;if(!R)continue;const F=M.alpha*f;if(F<=0)continue;const Z=wt(M.style,x);i.globalAlpha=F;let S=R;Z!==16777215&&(S=B.getTintedCanvas({texture:w},Z));const T=w.frame,q=w.source._resolution??w.source.resolution??1;let G=T.x*q,E=T.y*q;const X=T.width*q,O=T.height*q;S!==R&&(G=0,E=0);const V=M.transform,j=V&&!V.isIdentity(),A=w.rotate;j||A?(Ut.copyFrom(o),j&&Ut.append(V),A&&nt.matrixAppendRotationInv(Ut,A,M.dx,M.dy,M.dw,M.dh),s.setContextTransform(Ut,g===1)):s.setContextTransform(o,g===1),i.drawImage(S,G,E,S===R?X:S.width,S===R?O:S.height,A?0:M.dx,A?0:M.dy,M.dw,M.dh),(j||A)&&s.setContextTransform(o,g===1);continue}const m=P.data,k=m?.path?.shapePath;if(!k?.shapePrimitives?.length)continue;const _=m.style,C=wt(_.color,x),D=_.alpha*f;if(D<=0)continue;const I=P.action==="stroke";if(i.globalAlpha=D,I){const M=_;i.lineWidth=M.width,i.lineCap=M.cap,i.lineJoin=M.join,i.miterLimit=M.miterLimit}const v=k.shapePrimitives;if(!I&&m.hole?.shapePath?.shapePrimitives?.length){const M=v[v.length-1];M.holes=m.hole.shapePath.shapePrimitives}for(let M=0;M<v.length;M++){const w=v[M];if(!w?.shape)continue;const R=w.transform,F=R&&!R.isIdentity(),Z=_.texture&&_.texture!==ct.WHITE,S=_.textureSpace==="global"?R:null,T=Z?on(Mr,_,w.shape,S):null,q=F?Sr.copyFrom(o).append(R):o,G=Ir(_,C,T,q);if(F&&(i.save(),i.transform(R.a,R.b,R.c,R.d,R.tx,R.ty)),I){const E=_;if(E.alignment!==.5&&!E.pixelLine){const O=[],V=[],j=[];if(Ht[w.shape.type]?.build(w.shape,O)){const it=w.shape.closePath??!0;sn(O,E,!1,it,V,j),i.fillStyle=G,vr(i,V,j)}else i.strokeStyle=G,i.beginPath(),Vt(i,w.shape),i.stroke()}else i.strokeStyle=G,i.beginPath(),Vt(i,w.shape),i.stroke()}else i.fillStyle=G,i.beginPath(),Vt(i,w.shape),wr(i,w.holes)?i.fill("evenodd"):i.fill();F&&i.restore()}}i.restore()}destroy(){this.shader=null}}bn.extension={type:[z.CanvasPipesAdaptor],name:"graphics"};class Rr{init(t,e){this._renderer=t,this._renderTargetSystem=e}initGpuRenderTarget(t){const e=t.colorTexture,{canvas:n,context:s}=this._ensureCanvas(e);return{canvas:n,context:s,width:n.width,height:n.height}}resizeGpuRenderTarget(t){const e=t.colorTexture,{canvas:n}=this._ensureCanvas(e);n.width=t.pixelWidth,n.height=t.pixelHeight}startRenderPass(t,e,n,s){const i=this._renderTargetSystem.getGpuRenderTarget(t);this._renderer.canvasContext.activeContext=i.context,this._renderer.canvasContext.activeResolution=t.resolution,e&&this.clear(t,e,n,s)}clear(t,e,n,s){const o=this._renderTargetSystem.getGpuRenderTarget(t).context,a=s||{x:0,y:0,width:t.pixelWidth,height:t.pixelHeight};if(o.setTransform(1,0,0,1,0,0),o.clearRect(a.x,a.y,a.width,a.height),n){const c=$.shared.setValue(n);c.alpha>0&&(o.globalAlpha=c.alpha,o.fillStyle=c.toHex(),o.fillRect(a.x,a.y,a.width,a.height),o.globalAlpha=1)}}finishRenderPass(){}copyToTexture(t,e,n,s,i){const a=this._renderTargetSystem.getGpuRenderTarget(t).canvas,c=e.source,{context:l}=this._ensureCanvas(c),h=i?.x??0,u=i?.y??0;return l.drawImage(a,n.x,n.y,s.width,s.height,h,u,s.width,s.height),c.update(),e}destroyGpuRenderTarget(t){}_ensureCanvas(t){let e=t.resource;(!e||!An.test(e))&&(e=st.get().createCanvas(t.pixelWidth,t.pixelHeight),t.resource=e),(e.width!==t.pixelWidth||e.height!==t.pixelHeight)&&(e.width=t.pixelWidth,e.height=t.pixelHeight);const n=e.getContext("2d");return{canvas:e,context:n}}}class Cn extends Ln{constructor(t){super(t),this.adaptor=new Rr,this.adaptor.init(t,this)}}Cn.extension={type:[z.CanvasSystem],name:"renderTarget"};class Pn{constructor(t){}init(){}initSource(t){}generateCanvas(t){const e=st.get().createCanvas(),n=e.getContext("2d"),s=B.getCanvasSource(t);if(!s)return e;const i=t.frame,o=t.source._resolution??t.source.resolution??1,a=i.x*o,c=i.y*o,l=i.width*o,h=i.height*o;return e.width=Math.ceil(l),e.height=Math.ceil(h),n.drawImage(s,a,c,l,h,0,0,l,h),e}getPixels(t){const e=this.generateCanvas(t);return{pixels:e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e.width,e.height).data,width:e.width,height:e.height}}destroy(){}}Pn.extension={type:[z.CanvasSystem],name:"texture"};const Dr=[...Wn,mn,_n,Pn,Cn],Gr=[zn,qn,En,Un,Vn,yn,xn,jn],Ar=[yr,bn],Mn=[],Sn=[],vn=[];rt.handleByNamedList(z.CanvasSystem,Mn);rt.handleByNamedList(z.CanvasPipes,Sn);rt.handleByNamedList(z.CanvasPipesAdaptor,vn);rt.add(...Dr,...Gr,...Ar);class Wr extends Bn{constructor(){const t={name:"canvas",type:$n.CANVAS,systems:Mn,renderPipes:Sn,renderPipeAdaptors:vn};super(t)}}export{Wr as CanvasRenderer};
